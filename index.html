<!DOCTYPE html><html lang=en><meta charset=utf-8>
  <title>Loader</title>
  <link href=https://www.whatwg.org/style/specification rel=stylesheet>
  <link href=https://resources.whatwg.org/logo-javascript.svg rel=icon>
<script async src=//resources.whatwg.org/file-bug.js></script>
  <style>
  ol > li { margin: 0; }
</style>

<body class=h-entry>
<div class=head>
  <p data-fill-with=logo><a class=logo href=http://www.whatwg.org/>
    <img alt=WHATWG height=100 src=https://resources.whatwg.org/logo-javascript.svg>
</a>
</p>
  <h1 class="p-name no-ref" id=title>Loader</h1>
  <h2 class="no-num no-toc no-ref heading settled" id=subtitle><span class=content>A Collection of Interesting Ideas,
    <span class=dt-updated><span class=value-title title=20141001>1 October 2014</span></span></span></h2>
  <div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=https://whatwg.github.io/loader>https://whatwg.github.io/loader</a><dt>Editors:<dd><div class="p-author h-card vcard"><a class="p-name fn u-url url" href=https://github.com/ericf>Eric Ferraiuolo</a> (<a class="p-org org" href=https://yahoo.com>Yahoo</a>) <a class="u-email email" href=mailto:edf@ericf.me>edf@ericf.me</a></div><dd><div class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://calculist.org>Dave Herman</a> (<a class="p-org org" href=https://mozilla.org>Mozilla</a>) <a class="u-email email" href=mailto:dherman@mozilla.com>dherman@mozilla.com</a></div><dd><div class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://yehudakatz.com>Yehuda Katz</a> (<a class="p-org org" href=https://jquery.org>jQuery Foundation</a>) <a class="u-email email" href=mailto:wycats@gmail.com>wycats@gmail.com</a></div><dd><div class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://caridy.name>Caridy Pati√±o</a> (<a class="p-org org" href=https://yahoo.com>Yahoo</a>) <a class="u-email email" href=mailto:caridy@gmail.com>caridy@gmail.com</a></div><dt>Version History:<dd><span><a href=https://github.com/whatwg/loader/commits>https://github.com/whatwg/loader/commits</a></span><dt>Participate:<dd><span><a href=https://github.com/whatwg/loader/issues/new>File an issue</a> (<a href="https://github.com/whatwg/loader/issues?state=open">open issues</a>)</span></dl></div>
  <div data-fill-with=warning></div>
  <p class=copyright data-fill-with=copyright><a href=http://creativecommons.org/publicdomain/zero/1.0/ rel=license><img alt=CC0 src=https://i.creativecommons.org/p/zero/1.0/80x15.png></a>
To the extent possible under law, the editors have waived all copyright
and related or neighboring rights to this work.
In addition, as of 1 October 2014,
the editors have made this specification available under the
<a href=http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0 rel=license>Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from another specification document.  If so, those parts are instead covered by the license of that specification document.
</p>
  <hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled" id=abstract><span class=content>Abstract</span></h2>
<div class=p-summary data-fill-with=abstract><p>This specification describes the behavior of loading JavaScript modules from a

JavaScript host environment. It also provides APIs for intercepting the module
loading process and customizing loading behavior.</p>

</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled" id=contents><span class=content>Table of Contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc><li><a href=#intro><span class=secno>1</span> <span class=content>Introduction</span></a><li><a href=#pipeline><span class=secno>2</span> <span class=content>Loader Pipeline</span></a><ul class=toc><li><a href=#pipeline-semantics><span class=secno>2.1</span> <span class=content>Semantics</span></a><li><a href=#pipeline-api><span class=secno>2.2</span> <span class=content>API</span></a></ul><li><a href=#local><span class=secno>3</span> <span class=content>Local Loading</span></a><li><a href=#browser><span class=secno>4</span> <span class=content>Browser Loader</span></a><ul class=toc><li><a href=#browser-site-packages><span class=secno>4.1</span> <span class=content>Site Packages</span></a><ul class=toc><li><a href=#System-site><span class=secno>4.1.1</span> <span class=content>System.site( mappings )</span></a><li><a href=#System-site-get><span class=secno>4.1.2</span> <span class=content>System.site.get( name )</span></a><li><a href=#System-site-set><span class=secno>4.1.3</span> <span class=content>System.site.set( name, url )</span></a><li><a href=#System-site-has><span class=secno>4.1.4</span> <span class=content>System.site.has( name )</span></a><li><a href=#System-site-delete><span class=secno>4.1.5</span> <span class=content>System.site.delete( name )</span></a></ul><li><a href=#browser-normalize><span class=secno>4.2</span> <span class=content>Normalize</span></a><li><a href=#browser-locate><span class=secno>4.3</span> <span class=content>Locate</span></a><li><a href=#browser-fetch><span class=secno>4.4</span> <span class=content>Fetch</span></a><li><a href=#browser-translate><span class=secno>4.5</span> <span class=content>Translate</span></a><li><a href=#browser-instantiate><span class=secno>4.6</span> <span class=content>Instantiate</span></a></ul><li><a href=#conformance><span class=secno></span> <span class=content>Conformance</span></a><li><a href=#references><span class=secno></span> <span class=content>References</span></a><ul class=toc><li><a href=#normative><span class=secno></span> <span class=content>Normative References</span></a></ul><li><a href=#index><span class=secno></span> <span class=content>Index</span></a></ul></div>


<h2 class="no-num no-toc heading settled" id=status><span class=content>Status</span></h2>

<p>This document is a work in progress and dreams of becoming a living standard.</p>

<h2 class="heading settled" data-level=1 id=intro><span class=secno>1. </span><span class=content>Introduction</span><a class=self-link href=#intro></a></h2>

<p>Throughout their development, JavaScript modules have been divided into two general areas:</p>

<ul>
<li>The <b>authoring format</b>, which defines the importing and exporting syntax, as well as the semantics for variable bindings and cycles.
<li>The <b>JavaScript Loader</b>, which provides a pipeline for on-demand, asynchronous loading of JavaScript modules.
</ul>

<p>The authoring format was carefully designed to support pre-compilation (like Browserify) and on-demand asynchronous loading (like AMD). It defines the minimal syntax necessary to allow people to write portable modules that can work across different platforms, most notably Node.js and web browsers.</p>

<p>The JavaScript Loader allows host environments, like Node.js and browsers, to fetch and load modules on demand. It provides a hookable pipeline, to allow front-end packaging solutions like Browserify, WebPack and jspm to hook into the loading process.</p>

<p>This division provides a single format that developers can use in all JavaScript environments, and a separate loading mechanism for each environment. For example, a Node Loader would load its modules from the file system, consulting <code>package.json</code>, while a Browser Loader would fetch modules and use browser-supplied packaging formats.</p>

<p>JavaScript itself, in ECMAScript 2015, defines the module syntax and the "linking semantics" between modules. When a module is requested, it delegates responsibility for loading the module to the host environment. The Loader defines how host environments can allow JavaScript code to configure that process.</p>

<p>The primary goal is to make as much of this process as possible consistent between Node and Browser environments. For example, if a JavaScript program wants to translate <code>.coffee</code> files to JavaScript on the fly, the Loader defines a "translate" hook that can be used. This allows programs to participate in the loading process, even though some details (specifically, the process of getting a particular module from its host-defined storage) will be different between environments.</p>

<h2 class="heading settled" data-level=2 id=pipeline><span class=secno>2. </span><span class=content>Loader Pipeline</span><a class=self-link href=#pipeline></a></h2>

<p><b>TODO:</b> migrate from existing documents (<a href=https://github.com/jorendorff/js-loaders/wiki/Spec-Drafts>modules draft</a>, <a href="http://wiki.ecmascript.org/doku.php?id=harmony:specification_drafts#current_working_draft">ES6 drafts</a>)</p>

<h3 class="heading settled" data-level=2.1 id=pipeline-semantics><span class=secno>2.1. </span><span class=content>Semantics</span><a class=self-link href=#pipeline-semantics></a></h3>

<p><b>TODO:</b> migrate from <a href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-runtime-semantics-loader-state>15.2.3</a> and <a href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-runtime-semantics-module-loading>15.2.4</a></p>


<h3 class="heading settled" data-level=2.2 id=pipeline-api><span class=secno>2.2. </span><span class=content>API</span><a class=self-link href=#pipeline-api></a></h3>

<p><b>TODO:</b> migrate from <a href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-loader-objects>26.2</a> and <a href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-system-object>26.3</a></p>

<ul>
  <li>methods:
    <ul>
    <li><code>System.import(name, context).then(mod =&gt; ...)</code>
    <li><code>System.load(name, context).then(() =&gt; ...)</code>
    <li><code>System.provide(name, src)</code>
    </ul>
  <li>hooks:
    <ul>
    <li><code>System.hook("normalize"[, normalize])</code>
    <li><code>System.hook("locate"[, locate])</code>
    <li><code>System.hook("fetch"[, fetch])</code>
    <li><code>System.hook("translate"[, translate])</code>
    <li><code>System.hook("instantiate"[, instantiate])</code>
    </ul>
  <li>module registry:
    <ul>
    <li><code>System.modules.get("https://jquery.com/modules/v/2.1.1")</code>
    <li><code>System.modules.set("https://jquery.com/modules/v/2.1.1", mod)</code>
    <li><code>System.modules.delete("https://jquery.com/modules/v/2.1.1")</code>
    <li><code>System.modules.has("https://jquery.com/modules/v/2.1.1")</code>
    </ul>
</ul>

<h2 class="heading settled" data-level=3 id=local><span class=secno>3. </span><span class=content>Local Loading</span><a class=self-link href=#local></a></h2>

<p><b>TODO:</b></p>

<ul>
<li>syntax for accessing module local information: <code>import local from this;</code>
<li>dynamic import: <code>local.import()</code>
<li>extending the hooks to handle <code>this</code>
<li>debugging info
<li>room for host environment-specific data
</ul>


<h2 class="heading settled" data-level=4 id=browser><span class=secno>4. </span><span class=content>Browser Loader</span><a class=self-link href=#browser></a></h2>

<h3 class="heading settled" data-level=4.1 id=browser-site-packages><span class=secno>4.1. </span><span class=content>Site Packages</span><a class=self-link href=#browser-site-packages></a></h3>

<p>The browser loader contains extra properties for storing <dfn data-dfn-type=dfn data-noexport="" id=site-packages>site packages<a class=self-link href=#site-packages></a></dfn>, an application-global set of globally available packages. These map in an internal table to unique URLs that in turn serve as keys in the module registry.</p>

<div class=note>
<p>
The site package system serves as a simple coordination mechanism for modest-sized applications, but it does not provide all functionality required of a full-fledged package management system. It is expected that development ecosystems will build around package management tools that deal with requirements outside the scope of this specification, such as version management and allowing multiple versions of a library to coexist with the same name.
</p>

<p>
Tools that preprocess JavaScript source code may choose to use or ignore the site package table. For example, a package manager may choose to preprocess two separate import statements requiring <code>"jquery"</code> to <code>"jquery/1.9"</code> and <code>"jquery/2.1.1"</code> respectively, based on configuration files informing the tool of version requirements. The tool would then store both versions of jQuery in the site package table using the longer names. Alternatively, the tool may choose to preprocess the imports directly as URLs and bypass the site package system altogether.
</p>
</div>

<p>The browser loader has an extra internal slot:</p>

<table>
  <thead>
    <tr>
      <th>Internal Slot</th>
      <th>Description (<em>non-normative</em>)</th>
    </tr>
  </thead>
  <tr>
    <td>[[Site]]</td>
    <td>A table that maps package names to URLs.</td>
  </tr>
</table>

<h4 class="heading settled" data-level=4.1.1 id=System-site><span class=secno>4.1.1. </span><span class=content>System.site( mappings )</span><a class=self-link href=#System-site></a></h4>

<div class=example>
  <pre>System.site({
  "jquery":     "https://cdn.example.com/jquery/v/2.1.1",
  "underscore": "https://cdn.example.com/underscore/v/1.7.0",
  "moment":     "https://cdn.example.com/moment/v/2.8.3"
});
</pre>
</div>

<h4 class="heading settled" data-level=4.1.2 id=System-site-get><span class=secno>4.1.2. </span><span class=content>System.site.get( name )</span><a class=self-link href=#System-site-get></a></h4>

<div class=example>
  <pre>var url = System.site.get("jquery");
</pre>
</div>

<h4 class="heading settled" data-level=4.1.3 id=System-site-set><span class=secno>4.1.3. </span><span class=content>System.site.set( name, url )</span><a class=self-link href=#System-site-set></a></h4>

<div class=example>
  <pre>System.site.set("jquery", "https://cdn.example.com/jquery/v/2.1.1");
</pre>
</div>

<h4 class="heading settled" data-level=4.1.4 id=System-site-has><span class=secno>4.1.4. </span><span class=content>System.site.has( name )</span><a class=self-link href=#System-site-has></a></h4>

<div class=example>
  <pre>if (!System.site.has("jquery")) {
  System.site.set("jquery", "https://cdn.example.com/jquery/v/2.1.1");
}
</pre>
</div>

<h4 class="heading settled" data-level=4.1.5 id=System-site-delete><span class=secno>4.1.5. </span><span class=content>System.site.delete( name )</span><a class=self-link href=#System-site-delete></a></h4>

<div class=example>
  <pre>System.site.delete("jquery");
</pre>
</div>

<h3 class="heading settled" data-level=4.2 id=browser-normalize><span class=secno>4.2. </span><span class=content>Normalize</span><a class=self-link href=#browser-normalize></a></h3>

<p><b>TODO:</b> name resolution policy
<ul>
  <li>relative and site-relative URLs: <code>"./utils.js"</code>, <code>"/scripts/utils.js"</code>
  <li>JS standard modules: <code>"std/math"</code>, <code>"std/json"</code>, <code>"std/reflect"</code>
  <li>Web standard modules: <code>"web/worker"</code>, <code>"web/audio"</code>
  <li>absolute URLs: <code>"https://jquery.com/modules/v/2.0"</code>
  <li>top-level packages consult [[Site]]: <code>"jquery"</code>, <code>"ember/data"</code>
</ul><p></p>

<h3 class="heading settled" data-level=4.3 id=browser-locate><span class=secno>4.3. </span><span class=content>Locate</span><a class=self-link href=#browser-locate></a></h3>

<p><b>TODO:</b> no-op.</p>

<h3 class="heading settled" data-level=4.4 id=browser-fetch><span class=secno>4.4. </span><span class=content>Fetch</span><a class=self-link href=#browser-fetch></a></h3>

<p><b>TODO:</b>
<ul>
  <li>reference fetch standard
  <li>cross-origin produces an opaque object as in ServiceWorker
  <li>CORS, CSP
  <li>other kinds of web assets
</ul><p></p>

<h3 class="heading settled" data-level=4.5 id=browser-translate><span class=secno>4.5. </span><span class=content>Translate</span><a class=self-link href=#browser-translate></a></h3>

<p><b>TODO:</b> no-op.</p>

<h3 class="heading settled" data-level=4.6 id=browser-instantiate><span class=secno>4.6. </span><span class=content>Instantiate</span><a class=self-link href=#browser-instantiate></a></h3>

<p><b>TODO:</b>
<ul>
  <li>basically a no-op.
  <li>but also needs to re-absorb opaque responses.
</ul><p></p>

<h2 class="no-num no-ref heading settled" id=conformance><span class=content>Conformance</span><a class=self-link href=#conformance></a></h2>

<p>All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked
non-normative. Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED",  "SHOULD", "SHOULD NOT", "RECOMMENDED",
"MAY", and "OPTIONAL" in the normative parts of this specification are to be interpreted as described in RFC2119. For
readability, these words do not appear in all uppercase letters in this specification. <a data-biblio-type=normative data-link-type=biblio href=#biblio-rfc2119 title=RFC2119>[RFC2119]</a>

<p>Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end
result is equivalent.
<h2 class="no-num heading settled" id=references><span class=content>References</span><a class=self-link href=#references></a></h2><h3 class="no-num heading settled" id=normative><span class=content>Normative References</span><a class=self-link href=#normative></a></h3><dl><dt id=biblio-rfc2119 title=rfc2119><a class=self-link href=#biblio-rfc2119></a>[rfc2119]<dd>S. Bradner. <a href=http://www.ietf.org/rfc/rfc2119.txt>Key words for use in RFCs to Indicate Requirement Levels</a>. Best Current Practice. URL: <a href=http://www.ietf.org/rfc/rfc2119.txt>http://www.ietf.org/rfc/rfc2119.txt</a></dl><h2 class="no-num heading settled" id=index><span class=content>Index</span><a class=self-link href=#index></a></h2><ul class=indexlist><li>site packages, <a href=#site-packages title="section 4.1">4.1</a></ul>