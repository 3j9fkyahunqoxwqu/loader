<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <title>Loader</title>
  <link href="https://www.whatwg.org/style/specification" rel="stylesheet">
  <link href="https://resources.whatwg.org/bikeshed.css" rel="stylesheet">
  <link href="https://resources.whatwg.org/logo-javascript.svg" rel="icon">
  <meta content="Bikeshed 1.0.0" name="generator">
<style>
  .note + .example, .note + .note { margin-top: 1em; }

  emu-val { font-weight: bold; }
  emu-alg > ol, emu-alg > ol ol ol ol { list-style-type: decimal; }
  emu-alg > ol ol, emu-alg > ol ol ol ol ol { list-style-type: lower-alpha; }
  emu-alg > ol ol ol, emu-alg > ol ol ol ol ol ol { list-style-type: lower-roman; }
  emu-alg li { margin: 0; }
  emu-note { display: block; margin: 1em 0 1em 6em; color: #666; }
  emu-note::before { content: "Note"; text-transform: uppercase; margin-left: -6em; display: block; float: left; }
</style>
 </head>
 <body class="h-entry status-DREAM">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" height="100" src="https://resources.whatwg.org/logo-javascript.svg"> </a> </p>
   <h1 class="p-name no-ref" id="title">Loader</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">A Collection of Interesting Ideas — Last Updated <time class="dt-updated" datetime="2016-01-08">8 January 2016</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     </dt><dd><a class="u-url" href="https://whatwg.github.io/loader">https://whatwg.github.io/loader</a>
     </dd><dt>Issue Tracking:
     </dt><dd><a href="https://github.com/whatwg/loader/issues/">GitHub</a>
     </dd><dt class="editor">Editors:
     </dt><dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://github.com/ericf">Eric Ferraiuolo</a> (<a class="p-org org" href="https://yahoo.com">Yahoo</a>) <a class="u-email email" href="mailto:edf@ericf.me">edf@ericf.me</a>
     </dd><dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="http://calculist.org">Dave Herman</a> (<a class="p-org org" href="https://mozilla.org">Mozilla</a>) <a class="u-email email" href="mailto:dherman@mozilla.com">dherman@mozilla.com</a>
     </dd><dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="http://yehudakatz.com">Yehuda Katz</a> (<a class="p-org org" href="https://jquery.org">jQuery Foundation</a>) <a class="u-email email" href="mailto:wycats@gmail.com">wycats@gmail.com</a>
     </dd><dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="http://caridy.name">Caridy Patiño</a> (<a class="p-org org" href="https://yahoo.com">Yahoo</a>) <a class="u-email email" href="mailto:caridy@gmail.com">caridy@gmail.com</a>
     </dd><dt>Version History:
     </dt><dd><span><a href="https://github.com/whatwg/loader/commits">https://github.com/whatwg/loader/commits</a></span>
     </dd><dt>Participate:
     </dt><dd><span><a href="https://github.com/whatwg/loader/issues/new">File an issue</a> (<a href="https://github.com/whatwg/loader/issues?state=open">open issues</a>)</span>
     </dd><dd><span></span>
    </dd></dl>
   </div>
   <div data-fill-with="warning"></div>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>This specification describes the behavior of loading JavaScript modules from a

JavaScript host environment. It also provides APIs for intercepting the module
loading process and customizing loading behavior.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>
  <div data-fill-with="table-of-contents" role="navigation">
   <ul class="toc" role="directory">
    <li>
     <a href="#module-loading"><span class="secno">1</span> <span class="content">Module Loading</span></a>
     <ul class="toc">
      <li><a href="#intro"><span class="secno">1.1</span> <span class="content">Introduction</span></a>
      </li><li><a href="#pipeline"><span class="secno">1.2</span> <span class="content">Loader Pipeline</span></a>
     </li></ul>
    </li><li>
     <a href="#conventions"><span class="secno">2</span> <span class="content">Conventions</span></a>
     <ul class="toc">
      <li><a href="#well-known-symbols"><span class="secno">2.1</span> <span class="content">Well-Known Symbols</span></a>
      </li><li><a href="#well-known-intrinsic-objects"><span class="secno">2.2</span> <span class="content">Well-Known Intrinsic Objects</span></a>
      </li><li>
       <a href="#promises"><span class="secno">2.3</span> <span class="content">Promises</span></a>
       <ul class="toc">
        <li><a href="#reacting-to-promises"><span class="secno">2.3.1</span> <span class="content">Reacting to Promises</span></a>
       </li></ul>
      </li><li>
       <a href="#shorthand-phrases"><span class="secno">2.4</span> <span class="content">Shorthand Phrases</span></a>
       <ul class="toc">
        <li><a href="#reject-if-abrupt"><span class="secno">2.4.1</span> <span class="content">RejectIfAbrupt(x)</span></a>
       </li></ul>
      </li><li>
       <a href="#common-operations"><span class="secno">2.5</span> <span class="content">Common Operations</span></a>
       <ul class="toc">
        <li><a href="#create-object"><span class="secno">2.5.1</span> <span class="content">CreateObject()</span></a>
        </li><li><a href="#simple-define"><span class="secno">2.5.2</span> <span class="content">SimpleDefine(obj, name, value)</span></a>
       </li></ul>
      </li><li><a href="#common-operations0"><span class="secno">2.6</span> <span class="content">Built-in Function Objects</span></a>
     </li></ul>
    </li><li>
     <a href="#loader-objects"><span class="secno">3</span> <span class="content">Loader Objects</span></a>
     <ul class="toc">
      <li>
       <a href="#loader-constructor"><span class="secno">3.1</span> <span class="content">The Loader Constructor</span></a>
       <ul class="toc">
        <li><a href="#new-loader"><span class="secno">3.1.1</span> <span class="content">Loader()</span></a>
       </li></ul>
      </li><li>
       <a href="#properties-of-the-loader-constructor"><span class="secno">3.2</span> <span class="content">Properties of the Loader Constructor</span></a>
       <ul class="toc">
        <li><a href="#loader-prototype"><span class="secno">3.2.1</span> <span class="content">Loader.prototype</span></a>
       </li></ul>
      </li><li>
       <a href="#sec-properties-of-the-loader-prototype-object"><span class="secno">3.3</span> <span class="content">Properties of the Loader Prototype Object</span></a>
       <ul class="toc">
        <li><a href="#Loader.prototype.constructor"><span class="secno">3.3.1</span> <span class="content">Loader.prototype.constructor</span></a>
        </li><li><a href="#loader-import"><span class="secno">3.3.2</span> <span class="content">Loader.prototype.import(name[, referrer])</span></a>
        </li><li><a href="#loader-load-resolve"><span class="secno">3.3.3</span> <span class="content">Loader.prototype.resolve(name[, referrer])</span></a>
        </li><li><a href="#loader-load"><span class="secno">3.3.4</span> <span class="content">Loader.prototype.load(name[, referrer[, stage]])</span></a>
        </li><li><a href="#loader-registry"><span class="secno">3.3.5</span> <span class="content">get Loader.prototype.registry</span></a>
        </li><li><a href="#loader-@@tostringtag"><span class="secno">3.3.6</span> <span class="content">Loader.prototype [ @@toStringTag ]</span></a>
       </li></ul>
      </li><li><a href="#loader-internal-slots"><span class="secno">3.4</span> <span class="content">Properties of Loader Instances</span></a>
     </li></ul>
    </li><li>
     <a href="#registry"><span class="secno">4</span> <span class="content">Registry Objects</span></a>
     <ul class="toc">
      <li>
       <a href="#registry-abstract-operations"><span class="secno">4.1</span> <span class="content">Abstract Operations for Registry Objects</span></a>
       <ul class="toc">
        <li><a href="#registry-CreateRegistry"><span class="secno">4.1.1</span> <span class="content">CreateRegistry()</span></a>
       </li></ul>
      </li><li><a href="#registry-constructor"><span class="secno">4.2</span> <span class="content">The Registry Constructor</span></a>
      </li><li>
       <a href="#properties-of-the-registry-constructor"><span class="secno">4.3</span> <span class="content">Properties of the Registry Constructor</span></a>
       <ul class="toc">
        <li><a href="#registry-prototype"><span class="secno">4.3.1</span> <span class="content">Registry.prototype</span></a>
       </li></ul>
      </li><li>
       <a href="#registry-prototype-object"><span class="secno">4.4</span> <span class="content">Properties of the Registry Prototype Object</span></a>
       <ul class="toc">
        <li><a href="#registry-prototype-constructor"><span class="secno">4.4.1</span> <span class="content">Registry.prototype.constructor</span></a>
        </li><li><a href="#registry-prototype-@@iterator"><span class="secno">4.4.2</span> <span class="content">Registry.prototype[ @@iterator ]()</span></a>
        </li><li><a href="#registry-prototype-entries"><span class="secno">4.4.3</span> <span class="content">Registry.prototype.entries()</span></a>
        </li><li><a href="#registry-prototype-keys"><span class="secno">4.4.4</span> <span class="content">Registry.prototype.keys()</span></a>
        </li><li><a href="#registry-prototype-values"><span class="secno">4.4.5</span> <span class="content">Registry.prototype.values()</span></a>
        </li><li><a href="#registry-prototype-get"><span class="secno">4.4.6</span> <span class="content">Registry.prototype.get(key)</span></a>
        </li><li><a href="#registry-prototype-set"><span class="secno">4.4.7</span> <span class="content">Registry.prototype.set(key, entry)</span></a>
        </li><li><a href="#registry-prototype-has"><span class="secno">4.4.8</span> <span class="content">Registry.prototype.has(key)</span></a>
        </li><li><a href="#registry-prototype-delete"><span class="secno">4.4.9</span> <span class="content">Registry.prototype.delete(key)</span></a>
       </li></ul>
      </li><li><a href="#registry-internal-slots"><span class="secno">4.5</span> <span class="content">Properties of Registry Instances</span></a>
     </li></ul>
    </li><li>
     <a href="#module-status"><span class="secno">5</span> <span class="content">ModuleStatus Objects</span></a>
     <ul class="toc">
      <li>
       <a href="#module-status-abstract-operations"><span class="secno">5.1</span> <span class="content">Abstract Operations for ModuleStatus Objects</span></a>
       <ul class="toc">
        <li><a href="#module-status-GetCurrentStage"><span class="secno">5.1.1</span> <span class="content">GetCurrentStage(entry)</span></a>
        </li><li><a href="#module-status-IsValidStageValue"><span class="secno">5.1.2</span> <span class="content">IsValidStageValue(stage)</span></a>
        </li><li><a href="#module-status-GetStage"><span class="secno">5.1.3</span> <span class="content">GetStage(entry, stage)</span></a>
        </li><li><a href="#module-status-LoadModule"><span class="secno">5.1.4</span> <span class="content">LoadModule(entry, stage)</span></a>
        </li><li><a href="#module-status-UpgradeToStage"><span class="secno">5.1.5</span> <span class="content">UpgradeToStage(entry, stage)</span></a>
       </li></ul>
      </li><li>
       <a href="#module-status-constructor"><span class="secno">5.2</span> <span class="content">The ModuleStatus Constructor</span></a>
       <ul class="toc">
        <li><a href="#new-module-status"><span class="secno">5.2.1</span> <span class="content">ModuleStatus(loader, key)</span></a>
       </li></ul>
      </li><li>
       <a href="#properties-of-the-module-status-constructor"><span class="secno">5.3</span> <span class="content">Properties of the ModuleStatus Constructor</span></a>
       <ul class="toc">
        <li><a href="#module-status-prototype"><span class="secno">5.3.1</span> <span class="content">ModuleStatus.prototype</span></a>
       </li></ul>
      </li><li>
       <a href="#module-status-prototype-object"><span class="secno">5.4</span> <span class="content">Properties of the ModuleStatus Prototype Object</span></a>
       <ul class="toc">
        <li><a href="#module-status-prototype-constructor"><span class="secno">5.4.1</span> <span class="content">ModuleStatus.prototype.constructor</span></a>
        </li><li><a href="#module-status-stage"><span class="secno">5.4.2</span> <span class="content">get ModuleStatus.prototype.stage</span></a>
        </li><li><a href="#module-status-module"><span class="secno">5.4.3</span> <span class="content">get ModuleStatus.prototype.originalKey</span></a>
        </li><li><a href="#module-status-module0"><span class="secno">5.4.4</span> <span class="content">get ModuleStatus.prototype.module</span></a>
        </li><li><a href="#module-status-error"><span class="secno">5.4.5</span> <span class="content">get ModuleStatus.prototype.error</span></a>
        </li><li><a href="#module-status-error0"><span class="secno">5.4.6</span> <span class="content">get ModuleStatus.prototype.dependencies</span></a>
        </li><li><a href="#module-status-prototype-load"><span class="secno">5.4.7</span> <span class="content">ModuleStatus.prototype.load(stage)</span></a>
        </li><li><a href="#module-status-prototype-result"><span class="secno">5.4.8</span> <span class="content">ModuleStatus.prototype.result(stage)</span></a>
        </li><li><a href="#module-status-prototype-resolve"><span class="secno">5.4.9</span> <span class="content">ModuleStatus.prototype.resolve(stage, result)</span></a>
        </li><li><a href="#module-status-prototype-reject"><span class="secno">5.4.10</span> <span class="content">ModuleStatus.prototype.reject(stage, error)</span></a>
       </li></ul>
      </li><li><a href="#module-status-internal-slots"><span class="secno">5.5</span> <span class="content">Properties of ModuleStatus Instances</span></a>
     </li></ul>
    </li><li>
     <a href="#pipeline-semantics"><span class="secno">6</span> <span class="content">Loading Semantics</span></a>
     <ul class="toc">
      <li>
       <a href="#auxiliary-operations"><span class="secno">6.1</span> <span class="content">Auxiliary Operations</span></a>
       <ul class="toc">
        <li><a href="#ensure-registered"><span class="secno">6.1.1</span> <span class="content">EnsureRegistered(loader, key)</span></a>
        </li><li><a href="#resolve"><span class="secno">6.1.2</span> <span class="content">Resolve(loader, name, referrer)</span></a>
        </li><li><a href="#extract-dependencies"><span class="secno">6.1.3</span> <span class="content">ExtractDependencies(entry, optionalInstance, source)</span></a>
        </li><li><a href="#instantiation"><span class="secno">6.1.4</span> <span class="content">Instantiation(loader, result, source)</span></a>
       </li></ul>
      </li><li>
       <a href="#loading-operations"><span class="secno">6.2</span> <span class="content">Loading Operations</span></a>
       <ul class="toc">
        <li><a href="#request-fetch"><span class="secno">6.2.1</span> <span class="content">RequestFetch(entry)</span></a>
        </li><li><a href="#request-translate"><span class="secno">6.2.2</span> <span class="content">RequestTranslate(entry)</span></a>
        </li><li><a href="#request-instantiate"><span class="secno">6.2.3</span> <span class="content">RequestInstantiate(entry)</span></a>
        </li><li><a href="#request-satisfy"><span class="secno">6.2.4</span> <span class="content">RequestSatisfy(entry)</span></a>
        </li><li><a href="#request-link"><span class="secno">6.2.5</span> <span class="content">RequestLink(entry)</span></a>
        </li><li><a href="#request-ready"><span class="secno">6.2.6</span> <span class="content">RequestReady(entry)</span></a>
       </li></ul>
     </li></ul>
    </li><li>
     <a href="#linking-semantics"><span class="secno">7</span> <span class="content">Linking Semantics</span></a>
     <ul class="toc">
      <li>
       <a href="#resolving-dependencies"><span class="secno">7.1</span> <span class="content">Resolving Dependencies</span></a>
       <ul class="toc">
        <li><a href="#host-resolve-imported-module"><span class="secno">7.1.1</span> <span class="content">HostResolveImportedModule(module, requestName)</span></a>
       </li></ul>
      </li><li>
       <a href="#linking"><span class="secno">7.2</span> <span class="content">Linking</span></a>
       <ul class="toc">
        <li><a href="#link"><span class="secno">7.2.1</span> <span class="content">Link(root)</span></a>
        </li><li><a href="#dependency-graph"><span class="secno">7.2.2</span> <span class="content">DependencyGraph(root)</span></a>
        </li><li><a href="#compute-dependency-graph"><span class="secno">7.2.3</span> <span class="content">ComputeDependencyGraph(entry, result)</span></a>
       </li></ul>
     </li></ul>
    </li><li>
     <a href="#module-objects"><span class="secno">8</span> <span class="content">Module Objects</span></a>
     <ul class="toc">
      <li><a href="#reflective-module-record"><span class="secno">8.1</span> <span class="content">Reflective Module Records</span></a>
      </li><li>
       <a href="#module-abstract-operations"><span class="secno">8.2</span> <span class="content">Abstract Operations for Module Objects</span></a>
       <ul class="toc">
        <li><a href="#parse-exports-descriptors"><span class="secno">8.2.1</span> <span class="content">ParseExportsDescriptors(obj)</span></a>
        </li><li><a href="#create-module-mutator"><span class="secno">8.2.2</span> <span class="content">CreateModuleMutator(module)</span></a>
        </li><li><a href="#get-export-names"><span class="secno">8.2.3</span> <span class="content">GetExportNames(exportStarStack)</span></a>
        </li><li><a href="#resolve-export"><span class="secno">8.2.4</span> <span class="content">ResolveExport(exportName, resolveStack, exportStarStack)</span></a>
        </li><li><a href="#module-declaration-instantiation"><span class="secno">8.2.5</span> <span class="content">ModuleDeclarationInstantiation()</span></a>
        </li><li><a href="#module-evaluation"><span class="secno">8.2.6</span> <span class="content">ModuleEvaluation()</span></a>
       </li></ul>
      </li><li>
       <a href="#module-constructor"><span class="secno">8.3</span> <span class="content">The Module Constructor</span></a>
       <ul class="toc">
        <li><a href="#new-module"><span class="secno">8.3.1</span> <span class="content">Module(descriptors[, executor[, evaluate]])</span></a>
       </li></ul>
      </li><li>
       <a href="#properties-of-the-module-constructor"><span class="secno">8.4</span> <span class="content">Properties of the Module Constructor</span></a>
       <ul class="toc">
        <li><a href="#Module.evaluate"><span class="secno">8.4.1</span> <span class="content">Module.evaluate(m)</span></a>
        </li><li><a href="#Module.prototype"><span class="secno">8.4.2</span> <span class="content">Module.prototype</span></a>
       </li></ul>
      </li><li><a href="#module-internal-slots"><span class="secno">8.5</span> <span class="content">Properties of Module Instances</span></a>
     </li></ul>
    </li><li><a href="#local"><span class="secno">9</span> <span class="content">Local Loading</span></a>
    </li><li>
     <a href="#browser"><span class="secno">10</span> <span class="content">Browser Loader</span></a>
     <ul class="toc">
      <li><a href="#system-loader-instance"><span class="secno">10.1</span> <span class="content">System.loader Object</span></a>
     </li></ul>
    </li><li>
     <a href="#browser-loader"><span class="secno">11</span> <span class="content">BrowserLoader Objects</span></a>
     <ul class="toc">
      <li><a href="#browser-loader-constructor"><span class="secno">11.1</span> <span class="content">The BrowserLoader Constructor</span></a>
      </li><li>
       <a href="#properties-of-the-browser-loader-constructor"><span class="secno">11.2</span> <span class="content">Properties of the BrowserLoader Constructor</span></a>
       <ul class="toc">
        <li><a href="#browser-loader-prototype"><span class="secno">11.2.1</span> <span class="content">BrowserLoader.prototype</span></a>
       </li></ul>
      </li><li>
       <a href="#properties-of-the-browser-loader-prototype"><span class="secno">11.3</span> <span class="content">Properties of the BrowserLoader Prototype</span></a>
       <ul class="toc">
        <li><a href="#browser-loader-prototype-@@resolve"><span class="secno">11.3.1</span> <span class="content">BrowserLoader.prototype[ @@resolve ](name, referrer)</span></a>
        </li><li><a href="#browser-loader-prototype-@@fetch"><span class="secno">11.3.2</span> <span class="content">BrowserLoader.prototype[ @@fetch ](entry, key)</span></a>
        </li><li><a href="#browser-loader-prototype-@@translate"><span class="secno">11.3.3</span> <span class="content">BrowserLoader.prototype[ @@translate ](entry, payload)</span></a>
        </li><li><a href="#browser-loader-prototype-@@instantiate"><span class="secno">11.3.4</span> <span class="content">BrowserLoader.prototype[ @@instantiate ](entry, source)</span></a>
       </li></ul>
     </li></ul>
    </li><li>
     <a href="#annexes"><span class="secno"></span> <span class="content">Annexes</span></a>
     <ul class="toc">
      <li><a href="#list-of-well-known-intrinsic-objects"><span class="secno"></span> <span class="content">List of Well-Known Intrinsic Objects</span></a>
     </li></ul>
    </li><li><a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
    </li><li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ul class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </li></ul>
    </li><li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ul class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </li></ul>
   </li></ul>
  </div>
  <main>
<script async="" src="https://resources.whatwg.org/file-issue.js"></script>
   <h2 class="no-num no-toc heading settled" id="status"><span class="content">Status</span></h2>
   <p>This document is a work in progress and dreams of becoming a living standard.</p>
   <h2 class="heading settled" data-level="1" id="module-loading"><span class="secno">1. </span><span class="content">Module Loading</span><a class="self-link" href="#module-loading"></a></h2>
   <p><i>This section is non-normative.</i></p>
   <h3 class="heading settled" data-level="1.1" id="intro"><span class="secno">1.1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h3>
   <p>Throughout their development, JavaScript modules have been divided into two general areas:</p>
   <ul>
    <li>The <b>authoring format</b>, which defines the importing and exporting syntax, as well as the semantics for variable bindings and cycles. 
    </li><li>The <b>JavaScript Loader</b>, which provides a pipeline for on-demand, asynchronous loading of JavaScript modules. 
   </li></ul>
   <p>The authoring format was carefully designed to support pre-compilation (like Browserify) and on-demand asynchronous loading (like AMD). It defines the minimal syntax necessary to allow people to write portable modules that can work across different platforms, most notably Node.js and web browsers.</p>
   <p>The JavaScript Loader allows host environments, like Node.js and browsers, to fetch and load modules on demand. It provides a hookable pipeline, to allow front-end packaging solutions like Browserify, WebPack and jspm to hook into the loading process.</p>
   <p>This division provides a single format that developers can use in all JavaScript environments, and a separate loading mechanism for each environment. For example, a Node Loader would load its modules from the file system, using its own module lookup algorithm, while a Browser Loader would fetch modules and use browser-supplied packaging formats.</p>
   <p>JavaScript itself, in ECMAScript 2015, defines the module syntax and the "linking semantics" between modules. When a module is requested, it delegates responsibility for loading the module to the host environment. The Loader defines how host environments can allow JavaScript code to configure that process.</p>
   <p>The primary goal is to make as much of this process as possible consistent between Node and Browser environments. For example, if a JavaScript program wants to translate <code>.coffee</code> files to JavaScript on the fly, the Loader defines a "translate" hook that can be used. This allows programs to participate in the loading process, even though some details (specifically, the process of getting a particular module from its host-defined storage) will be different between environments.</p>
   <h3 class="heading settled" data-level="1.2" id="pipeline"><span class="secno">1.2. </span><span class="content">Loader Pipeline</span><a class="self-link" href="#pipeline"></a></h3>
   <p><b>TODO:</b> include pipeline diagram</p>
   <h2 class="heading settled" data-level="2" id="conventions"><span class="secno">2. </span><span class="content">Conventions</span><a class="self-link" href="#conventions"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="well-known-symbols"><span class="secno">2.1. </span><span class="content">Well-Known Symbols</span><a class="self-link" href="#well-known-symbols"></a></h3>
   <p>Well-known symbols are built-in Symbol values that are explicitly referenced by algorithms of this specification. They are typically used as the keys of properties whose values serve as extension points of a specification algorithm.</p>
   <p>Within this specification a well-known symbol is referred to by using a notation of the form @@<i>name</i>, where "<i>name</i>" is one of the values listed in table below:</p>
   <table>
    <thead>
     <tr>
      <th>Specification Name
      </th><th>[[Description]]
      </th><th>Value and Purpose
    </th></tr></thead><tbody>
     <tr>
      <td>@@resolve
      </td><td>"Reflect.Loader.resolve"
      </td><td>A function valued property that is the resolve hook function of loader’s instances.
     </td></tr><tr>
      <td>@@fetch
      </td><td>"Reflect.Loader.fetch"
      </td><td>A function valued property that is the fetch hook function of loader’s instances.
     </td></tr><tr>
      <td>@@translate
      </td><td>"Reflect.Loader.translate"
      </td><td>A function valued property that is the translate hook function of loader’s instances.
     </td></tr><tr>
      <td>@@instantiate
      </td><td>"Reflect.Loader.instantiate"
      </td><td>A function valued property that is the instantiate hook function of loader’s instances.
   </td></tr></tbody></table>
   <h3 class="heading settled" data-level="2.2" id="well-known-intrinsic-objects"><span class="secno">2.2. </span><span class="content">Well-Known Intrinsic Objects</span><a class="self-link" href="#well-known-intrinsic-objects"></a></h3>
   <p>Well-known intrinsics are built-in objects that are explicitly referenced by the algorithms of this specification and which usually have Realm specific identities. Unless otherwise specified each intrinsic object actually corresponds to a set of similar objects, one per Realm.</p>
   <p>Within this specification a reference such as %<i>name</i>% means the intrinsic object, associated with the current Realm, corresponding to the <i>name</i>. Determination of the current Realm and its intrinsics is described in ES2015, 8.3.</p>
   <h3 class="heading settled" data-level="2.3" id="promises"><span class="secno">2.3. </span><span class="content">Promises</span><a class="self-link" href="#promises"></a></h3>
   <p>This spec makes heavy use of promises, and adopts the notational conventions established in the promises guide.</p>
   <h4 class="heading settled" data-level="2.3.1" id="reacting-to-promises"><span class="secno">2.3.1. </span><span class="content">Reacting to Promises</span><a class="self-link" href="#reacting-to-promises"></a></h4>
   <p><b><i>Transforming</i> p <i>with a new pass-through promise</i></b> is a shorthand for wrapping the promise to avoid exposing the original promise. It represents the following step:</p>
<emu-alg><ol><li>Transforming <var>p</var> with a fulfillment handler that, when called with argument <var>value</var>, returns <var>value</var>.</li></ol></emu-alg>
   <h3 class="heading settled" data-level="2.4" id="shorthand-phrases"><span class="secno">2.4. </span><span class="content">Shorthand Phrases</span><a class="self-link" href="#shorthand-phrases"></a></h3>
   <h4 aoid="RejectIfAbrupt" class="heading settled" data-level="2.4.1" id="reject-if-abrupt"><span class="secno">2.4.1. </span><span class="content">RejectIfAbrupt(x)</span><a class="self-link" href="#reject-if-abrupt"></a></h4>
   <p>Algorithm steps that say</p>
<emu-alg><ol><li><a href="#reject-if-abrupt">RejectIfAbrupt</a>(<var>x</var>).</li></ol></emu-alg>
   <p>mean the same thing as:</p>
<emu-alg><ol><li>If <var>x</var> is an abrupt completion, return a promise rejected with <var>x</var>.[[Value]].</li><li>Else if <var>x</var> is a Completion Record, then let <var>x</var> be <var>x</var>.[[Value]].</li></ol></emu-alg>
   <h3 class="heading settled" data-level="2.5" id="common-operations"><span class="secno">2.5. </span><span class="content">Common Operations</span><a class="self-link" href="#common-operations"></a></h3>
   <h4 aoid="CreateObject" class="heading settled" data-level="2.5.1" id="create-object"><span class="secno">2.5.1. </span><span class="content">CreateObject()</span><a class="self-link" href="#create-object"></a></h4>
<emu-alg><ol><li>Let <var>obj</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-objectcreate">ObjectCreate</a>(%ObjectPrototype%).</li><li>Return <var>obj</var>.</li></ol></emu-alg>
   <h4 aoid="SimpleDefine" class="heading settled" data-level="2.5.2" id="simple-define"><span class="secno">2.5.2. </span><span class="content">SimpleDefine(obj, name, value)</span><a class="self-link" href="#simple-define"></a></h4>
<emu-alg><ol><li>Let <var>desc</var> be a new PropertyDescriptor record {[[Value]]: <var>value</var>, [[Writable]]: <emu-val>true</emu-val>, [[Enumerable]]: <emu-val>true</emu-val>, [[Configurable]]: <emu-val>true</emu-val>}.</li><li>Return ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ordinarydefineownproperty">OrdinaryDefineOwnProperty</a>(<var>obj</var>, <var>name</var>, <var>desc</var>).</li></ol></emu-alg>
   <h3 class="heading settled" data-level="2.6" id="common-operations0"><span class="secno">2.6. </span><span class="content">Built-in Function Objects</span><a class="self-link" href="#common-operations0"></a></h3>
   <p>We follow the ECMA-262 <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-built-in-function-objects">convention for built-in function objects</a> in which the value of NewTarget in each function argument is <b>**undefined**</b> for [[Call]] and the <i>newTarget</i> parameter for [[Construct]].</p>
   <h2 class="heading settled" data-level="3" id="loader-objects"><span class="secno">3. </span><span class="content">Loader Objects</span><a class="self-link" href="#loader-objects"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="loader-constructor"><span class="secno">3.1. </span><span class="content">The Loader Constructor</span><a class="self-link" href="#loader-constructor"></a></h3>
   <p>The Loader constructor is the %Loader% intrinsic object and the initial value of the <b>Loader</b> property of the the Reflect object. When called as a constructor it creates and initializes a new Loader object. When <b>Loader</b> is called as a function rather than as a constructor, it throws an exception.</p>
   <p>The <b>Loader</b> constructor is designed to be subclassable. It may be used as the value of an <b>extends</b> clause of a class definition. Subclass constructors that intend to inherit the specified <b>Loader</b> behaviour must include a <b>super</b> call to the <b>Loader</b> constructor to create and initialize the subclass instance with the corresponding internal slots.</p>
   <h4 class="heading settled" data-level="3.1.1" id="new-loader"><span class="secno">3.1.1. </span><span class="content">Loader()</span><a class="self-link" href="#new-loader"></a></h4>
   <p>When Loader is called with no arguments, the following steps are taken:</p>
<emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, then throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>O</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a>(NewTarget, "%LoaderPrototype%", «[[Realm]], [[Registry]]»).</li><li>Set <var>O</var>’s [[Registry]] internal slot to <a href="#registry-CreateRegistry">CreateRegistry</a>().</li><li>Return <var>O</var>.</li></ol></emu-alg>
   <h3 class="heading settled" data-level="3.2" id="properties-of-the-loader-constructor"><span class="secno">3.2. </span><span class="content">Properties of the Loader Constructor</span><a class="self-link" href="#properties-of-the-loader-constructor"></a></h3>
   <p>The value of the [[Prototype]] internal slot of the Loader constructor is the intrinsic object %FunctionPrototype%.</p>
   <p>Besides the internal slots and the length property (whose value is 0), the Loader constructor has the following properties:</p>
   <h4 class="heading settled" data-level="3.2.1" id="loader-prototype"><span class="secno">3.2.1. </span><span class="content">Loader.prototype</span><a class="self-link" href="#loader-prototype"></a></h4>
   <p>The initial value of Loader.prototype is the intrinsic object %LoaderPrototype%.</p>
   <p>This property has the attributes { [[Writable]]: false, [[Enumerable]]: false, [[Configurable]]: false }.</p>
   <h3 class="heading settled" data-level="3.3" id="sec-properties-of-the-loader-prototype-object"><span class="secno">3.3. </span><span class="content">Properties of the Loader Prototype Object</span><a class="self-link" href="#sec-properties-of-the-loader-prototype-object"></a></h3>
   <h4 class="heading settled" data-level="3.3.1" id="Loader.prototype.constructor"><span class="secno">3.3.1. </span><span class="content">Loader.prototype.constructor</span><a class="self-link" href="#Loader.prototype.constructor"></a></h4>
   <p>The initial value of Loader.prototype.constructor is the intrinsic object %Loader%.</p>
   <h4 class="heading settled" data-level="3.3.2" id="loader-import"><span class="secno">3.3.2. </span><span class="content">Loader.prototype.import(name[, referrer])</span><a class="self-link" href="#loader-import"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>loader</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>loader</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>loader</var> does not have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Return the result of transforming <a href="#resolve">Resolve</a>(<var>loader</var>, <var>name</var>, <var>referrer</var>) with a fulfillment handler that, when called with argument <var>key</var>, runs the following steps:<ol><li>Let <var>entry</var> be <a href="#ensure-registered">EnsureRegistered</a>(<var>loader</var>, <var>key</var>).</li><li>Return <a href="#module-status-LoadModule">LoadModule</a>(<var>entry</var>, "ready").</li></ol></li></ol></emu-alg>
   <h4 class="heading settled" data-level="3.3.3" id="loader-load-resolve"><span class="secno">3.3.3. </span><span class="content">Loader.prototype.resolve(name[, referrer])</span><a class="self-link" href="#loader-load-resolve"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>loader</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>loader</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>loader</var> does not have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Return the result of transforming <a href="#resolve">Resolve</a>(<var>loader</var>, <var>name</var>, <var>referrer</var>) with a new pass-through promise.</li></ol></emu-alg>
   <h4 class="heading settled" data-level="3.3.4" id="loader-load"><span class="secno">3.3.4. </span><span class="content">Loader.prototype.load(name[, referrer[, stage]])</span><a class="self-link" href="#loader-load"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>loader</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>loader</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>loader</var> does not have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>stage</var> is <emu-val>undefined</emu-val> then let <var>stageValue</var> be "ready".</li><li>Else let <var>stageValue</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(<var>stage</var>).</li><li><a href="#reject-if-abrupt">RejectIfAbrupt</a>(<var>stageValue</var>).</li><li>If IsValidStageValue(<var>stageValue</var>) is <emu-val>false</emu-val>, return a promise rejected with a new <emu-val>RangeError</emu-val> exception.</li><li>Return the result of transforming <a href="#resolve">Resolve</a>(<var>loader</var>, <var>name</var>, <var>referrer</var>) with a fulfillment handler that, when called with argument <var>key</var>, runs the following steps:<ol><li>Let <var>entry</var> be <a href="#ensure-registered">EnsureRegistered</a>(<var>loader</var>, <var>key</var>).</li><li>Return <a href="#module-status-LoadModule">LoadModule</a>(<var>entry</var>, <var>stageValue</var>).</li></ol></li></ol></emu-alg>
   <h4 class="heading settled" data-level="3.3.5" id="loader-registry"><span class="secno">3.3.5. </span><span class="content">get Loader.prototype.registry</span><a class="self-link" href="#loader-registry"></a></h4>
   <p><code>Loader.prototype.registry</code> is an accessor property whose set accessor function is undefined. Its get accessor function performs the following steps:</p>
<emu-alg><ol><li>Let <var>loader</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>loader</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>loader</var> does not have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Return <var>loader</var>.[[Registry]].</li></ol></emu-alg>
   <h4 class="heading settled" data-level="3.3.6" id="loader-@@tostringtag"><span class="secno">3.3.6. </span><span class="content">Loader.prototype [ @@toStringTag ]</span><a class="self-link" href="#loader-%40%40tostringtag"></a></h4>
   <p>The initial value of the @@toStringTag property is the String value "Object".</p>
   <p>This property has the attributes { [[Writable]]: false, [[Enumerable]]: false, [[Configurable]]: true }.</p>
   <h3 class="heading settled" data-level="3.4" id="loader-internal-slots"><span class="secno">3.4. </span><span class="content">Properties of Loader Instances</span><a class="self-link" href="#loader-internal-slots"></a></h3>
   <p>Loader instances are ordinary objects that inherit properties from the *Loader.prototype*.</p>
   <p>Loader instances are initially created with the internal slots described in the following table:</p>
   <table>
    <thead>
     <tr>
      <th>Internal Slot
      </th><th>Value Type (<em>non-normative</em>)
      </th><th>Description (<em>non-normative</em>)
    </th></tr></thead><tbody>
     <tr>
      <td>[[Realm]]
      </td><td>Realm Record
      </td><td>The realm this loader belongs to.
     </td></tr><tr>
      <td>[[Registry]]
      </td><td>An object
      </td><td>An instance of <a href="#registry">Registry</a>.
   </td></tr></tbody></table>
   <h2 class="heading settled" data-level="4" id="registry"><span class="secno">4. </span><span class="content">Registry Objects</span><a class="self-link" href="#registry"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="registry-abstract-operations"><span class="secno">4.1. </span><span class="content">Abstract Operations for Registry Objects</span><a class="self-link" href="#registry-abstract-operations"></a></h3>
   <h4 aoid="CreateRegistry" class="heading settled" data-level="4.1.1" id="registry-CreateRegistry"><span class="secno">4.1.1. </span><span class="content">CreateRegistry()</span><a class="self-link" href="#registry-CreateRegistry"></a></h4>
   <p>The abstract operation CreateRegistry with no arguments performs the following steps:</p>
<emu-alg><ol><li>Let <var>O</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a>(Registry, "%RegistryPrototype%", «[[RegistryMap]]» ).</li><li>Let <var>M</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-objectcreate">ObjectCreate</a>(%MapIteratorPrototype%, «[[Map]], [[MapNextIndex]], [[MapIterationKind]]»).</li><li>Set <var>O</var>’s [[RegistryMap]] internal slot to <var>M</var>.</li><li>Return <var>O</var>.</li></ol></emu-alg>
   <h3 class="heading settled" data-level="4.2" id="registry-constructor"><span class="secno">4.2. </span><span class="content">The Registry Constructor</span><a class="self-link" href="#registry-constructor"></a></h3>
   <p>The Registry constructor is the %Registry% intrinsic object. It is not intended to be called as a function or as a constructor and will always throw an exception.</p>
   <h3 class="heading settled" data-level="4.3" id="properties-of-the-registry-constructor"><span class="secno">4.3. </span><span class="content">Properties of the Registry Constructor</span><a class="self-link" href="#properties-of-the-registry-constructor"></a></h3>
   <p>The value of the [[Prototype]] internal slot of the Registry constructor is the intrinsic object %FunctionPrototype%.</p>
   <p>Besides the internal slots and the length property (whose value is 0), the Registry constructor has the following properties:</p>
   <h4 class="heading settled" data-level="4.3.1" id="registry-prototype"><span class="secno">4.3.1. </span><span class="content">Registry.prototype</span><a class="self-link" href="#registry-prototype"></a></h4>
   <p>The initial value of Registry.prototype is %RegistryPrototype%.</p>
   <p>This property has the attributes { [[Writable]]: false, [[Enumerable]]: false, [[Configurable]]: false }.</p>
   <h3 class="heading settled" data-level="4.4" id="registry-prototype-object"><span class="secno">4.4. </span><span class="content">Properties of the Registry Prototype Object</span><a class="self-link" href="#registry-prototype-object"></a></h3>
   <h4 class="heading settled" data-level="4.4.1" id="registry-prototype-constructor"><span class="secno">4.4.1. </span><span class="content">Registry.prototype.constructor</span><a class="self-link" href="#registry-prototype-constructor"></a></h4>
   <p>The initial value of the constructor property of the %RegistryPrototype% object is the %Registry% object.</p>
<emu-note>
Always throws to prevent the creation of new registry objects in user-land.
</emu-note>
   <h4 class="heading settled" data-level="4.4.2" id="registry-prototype-@@iterator"><span class="secno">4.4.2. </span><span class="content">Registry.prototype[ @@iterator ]()</span><a class="self-link" href="#registry-prototype-%40%40iterator"></a></h4>
   <p>The initial value of the @@iterator property is the same function object as the initial value of the entries property.</p>
   <p>The value of the name property of this function is "[Symbol.iterator]".</p>
   <h4 class="heading settled" data-level="4.4.3" id="registry-prototype-entries"><span class="secno">4.4.3. </span><span class="content">Registry.prototype.entries()</span><a class="self-link" href="#registry-prototype-entries"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>registry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>registry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>registry</var> does not have all of the internal slots of a Registry Instance (<a href="#registry-internal-slots">4.4</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>M</var> be <var>registry</var>.[[RegistryMap]].</li><li>Return CreateMapIterator(<var>M</var>, "key+value").</li></ol></emu-alg>
   <h4 class="heading settled" data-level="4.4.4" id="registry-prototype-keys"><span class="secno">4.4.4. </span><span class="content">Registry.prototype.keys()</span><a class="self-link" href="#registry-prototype-keys"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>registry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>registry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>registry</var> does not have all of the internal slots of a Registry Instance (<a href="#registry-internal-slots">4.4</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>M</var> be <var>registry</var>.[[RegistryMap]].</li><li>Return CreateMapIterator(<var>M</var>, "key").</li></ol></emu-alg>
   <h4 class="heading settled" data-level="4.4.5" id="registry-prototype-values"><span class="secno">4.4.5. </span><span class="content">Registry.prototype.values()</span><a class="self-link" href="#registry-prototype-values"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>registry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>registry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>registry</var> does not have all of the internal slots of a Registry Instance (<a href="#registry-internal-slots">4.4</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>M</var> be <var>registry</var>.[[RegistryMap]].</li><li>Return CreateMapIterator(<var>M</var>, "value").</li></ol></emu-alg>
   <h4 class="heading settled" data-level="4.4.6" id="registry-prototype-get"><span class="secno">4.4.6. </span><span class="content">Registry.prototype.get(key)</span><a class="self-link" href="#registry-prototype-get"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>registry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>registry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>registry</var> does not have all of the internal slots of a Registry Instance (<a href="#registry-internal-slots">4.4</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>M</var> be <var>registry</var>.[[RegistryMap]].</li><li>Let <var>entries</var> be the List that is the value of <var>M</var>’s [[MapData]] internal slot.</li><li>Repeat for each Record {[[key]], [[value]]} <var>p</var> that is an element of <var>entries</var>,<ol><li>If <var>p</var>.[[key]] is not empty and <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-samevaluezero">SameValueZero</a>(<var>p</var>.[[key]], <var>key</var>) is <emu-val>true</emu-val>, return <var>p</var>.[[value]].</li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
   <h4 class="heading settled" data-level="4.4.7" id="registry-prototype-set"><span class="secno">4.4.7. </span><span class="content">Registry.prototype.set(key, entry)</span><a class="self-link" href="#registry-prototype-set"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>registry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>registry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>registry</var> does not have all of the internal slots of a Registry Instance (<a href="#registry-internal-slots">4.4</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>M</var> be <var>registry</var>.[[RegistryMap]].</li><li>Let <var>entries</var> be the List that is the value of <var>M</var>’s [[MapData]] internal slot.</li><li>Repeat for each Record {[[key]], [[value]]} <var>p</var> that is an element of <var>entries</var>,<ol><li>If <var>p</var>.[[key]] is not empty and <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-samevaluezero">SameValueZero</a>(<var>p</var>.[[key]], <var>key</var>) is <emu-val>true</emu-val>, then<ol><li>Set <var>p</var>.[[value]] to <var>entry</var>.</li><li>Return <var>registry</var>.</li></ol></li></ol></li><li>Let <var>p</var> be the Record {[[key]]: <var>key</var>, [[value]]: <var>entry</var>}.</li><li>Append <var>p</var> as the last element of <var>entries</var>.</li><li>Return <var>registry</var>.</li></ol></emu-alg>
   <h4 class="heading settled" data-level="4.4.8" id="registry-prototype-has"><span class="secno">4.4.8. </span><span class="content">Registry.prototype.has(key)</span><a class="self-link" href="#registry-prototype-has"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>registry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>registry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>registry</var> does not have all of the internal slots of a Registry Instance (<a href="#registry-internal-slots">4.4</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>M</var> be <var>registry</var>.[[RegistryMap]].</li><li>Let <var>entries</var> be the List that is the value of <var>M</var>’s [[MapData]] internal slot.</li><li>Repeat for each Record {[[key]], [[value]]} <var>p</var> that is an element of <var>entries</var>,<ol><li>If <var>p</var>.[[key]] is not empty and <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-samevaluezero">SameValueZero</a>(<var>p</var>.[[key]], <var>key</var>) is <emu-val>true</emu-val>, then, return <emu-val>true</emu-val>.</li></ol></li><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
   <h4 class="heading settled" data-level="4.4.9" id="registry-prototype-delete"><span class="secno">4.4.9. </span><span class="content">Registry.prototype.delete(key)</span><a class="self-link" href="#registry-prototype-delete"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>registry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>registry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>registry</var> does not have all of the internal slots of a Registry Instance (<a href="#registry-internal-slots">4.4</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>M</var> be <var>registry</var>.[[RegistryMap]].</li><li>Let <var>entries</var> be the List that is the value of <var>M</var>’s [[MapData]] internal slot.</li><li>Repeat for each Record {[[key]], [[value]]} <var>p</var> that is an element of <var>entries</var>,<ol><li>If <var>p</var>.[[key]] is not empty and <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-samevaluezero">SameValueZero</a>(<var>p</var>.[[key]], <var>key</var>) is <emu-val>true</emu-val>, then<ol><li>Set <var>p</var>.[[key]] to empty.</li><li>Set <var>p</var>.[[value]] to empty.</li><li>Return <emu-val>true</emu-val>.</li></ol></li></ol></li><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
<emu-note>
  The value empty is used as a specification device to indicate that an entry has been deleted. Actual implementations may take other actions such as physically removing the entry from internal data structures.
</emu-note>
   <h3 class="heading settled" data-level="4.5" id="registry-internal-slots"><span class="secno">4.5. </span><span class="content">Properties of Registry Instances</span><a class="self-link" href="#registry-internal-slots"></a></h3>
   <p>Registry instances are ordinary objects that inherit properties from the %RegistryPrototype%.</p>
   <p>Registry instances are initially created with the internal slots described in the following table:</p>
   <table>
    <thead>
     <tr>
      <th>Internal Slot
      </th><th>Value Type (<em>non-normative</em>)
      </th><th>Description (<em>non-normative</em>)
    </th></tr></thead><tbody>
     <tr>
      <td>[[RegistryMap]]
      </td><td>The Map object of pairs of String and <a href="#module-status">module status</a>.
      </td><td>The registry of installed modules.
   </td></tr></tbody></table>
   <h2 class="heading settled" data-level="5" id="module-status"><span class="secno">5. </span><span class="content">ModuleStatus Objects</span><a class="self-link" href="#module-status"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="module-status-abstract-operations"><span class="secno">5.1. </span><span class="content">Abstract Operations for ModuleStatus Objects</span><a class="self-link" href="#module-status-abstract-operations"></a></h3>
   <h4 aoid="GetCurrentStage" class="heading settled" data-level="5.1.1" id="module-status-GetCurrentStage"><span class="secno">5.1.1. </span><span class="content">GetCurrentStage(entry)</span><a class="self-link" href="#module-status-GetCurrentStage"></a></h4>
   <p>The abstract operation GetCurrentStage with argument <i>entry</i> performs the following steps:</p>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>stages</var> be <var>entry</var>.[[Pipeline]].</li><li>Return the first element of <var>stages</var>.</li></ol></emu-alg>
   <h4 aoid="GetCurrentStage" class="heading settled" data-level="5.1.2" id="module-status-IsValidStageValue"><span class="secno">5.1.2. </span><span class="content">IsValidStageValue(stage)</span><a class="self-link" href="#module-status-IsValidStageValue"></a></h4>
   <p>The abstract operation IsValidStageValue with argument <i>stage</i> performs the following steps:</p>
<emu-alg><ol><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>stage</var>) is String.</li><li>If <var>stage</var> is "fetch", "translate", "instantiate", "satisfy", "link" or "ready", return <emu-val>true</emu-val>.</li><li>Else return <emu-val>false</emu-val>.</li></ol></emu-alg>
   <h4 aoid="GetStage" class="heading settled" data-level="5.1.3" id="module-status-GetStage"><span class="secno">5.1.3. </span><span class="content">GetStage(entry, stage)</span><a class="self-link" href="#module-status-GetStage"></a></h4>
   <p>The abstract operation GetStage with arguments <i>entry</i> and <i>stage</i> performs the following steps:</p>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>stage</var>) is String.</li><li>Let <var>stages</var> be <var>entry</var>.[[Pipeline]].</li><li>For each element <var>stageEntry</var> of <var>stages</var>, do<ol><li>If <var>stageEntry</var>.[[Stage]] is equal to <var>stage</var>, return <var>stageEntry</var>.</li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
   <h4 aoid="LoadModule" class="heading settled" data-level="5.1.4" id="module-status-LoadModule"><span class="secno">5.1.4. </span><span class="content">LoadModule(entry, stage)</span><a class="self-link" href="#module-status-LoadModule"></a></h4>
   <p>The abstract operation LoadModule with arguments <i>entry</i> and <i>stage</i> performs the following steps:</p>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>stage</var>) is String.</li><li>Assert: <var>stage</var> is a valid stage value.</li><li>If <var>stage</var> is "fetch", then:<ol><li>Return the result of transforming <a href="#request-fetch">RequestFetch</a>(<var>entry</var>) with a new pass-through promise.</li></ol></li><li>If <var>stage</var> is "translate", then:<ol><li>Return the result of transforming <a href="#request-translate">RequestTranslate</a>(<var>entry</var>) with a new pass-through promise.</li></ol></li><li>If <var>stage</var> is "instantiate", then:<ol><li>Return the result of transforming <a href="#request-instantiate">RequestInstantiate</a>(<var>entry</var>) with a new pass-through promise.</li></ol></li><li>If <var>stage</var> is "satisfy", then:<ol><li>Return the result of transforming <a href="#request-satisfy">RequestSatisfy</a>(<var>entry</var>) with a new pass-through promise.</li></ol></li><li>If <var>stage</var> is "link", then:<ol><li>Return the result of transforming <a href="#request-link">RequestLink</a>(<var>entry</var>) with a new pass-through promise.</li></ol></li><li>If <var>stage</var> is "ready", then:<ol><li>Return the result of transforming <a href="#request-ready">RequestReady</a>(<var>entry</var>) with a new pass-through promise.</li></ol></li><li>Return a promise rejected with a new <emu-val>RangeError</emu-val> exception.</li></ol></emu-alg>
   <h4 aoid="UpgradeToStage" class="heading settled" data-level="5.1.5" id="module-status-UpgradeToStage"><span class="secno">5.1.5. </span><span class="content">UpgradeToStage(entry, stage)</span><a class="self-link" href="#module-status-UpgradeToStage"></a></h4>
   <p>The abstract operation UpgradeToStage with arguments <i>entry</i> and <i>stage</i> performs the following steps:</p>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>stage</var>) is String.</li><li>Let <var>pipeline</var> be <var>entry</var>.[[Pipeline]].</li><li>Let <var>stageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, <var>stage</var>).</li><li>If <var>stageEntry</var> is not <emu-val>undefined</emu-val>, then<ol><li>Repeat while the first element of <var>pipeline</var> is not equal to <var>stageEntry</var><ol><li>Remove first element from <var>pipeline</var>.</li></ol></li></ol></li></ol></emu-alg>
<emu-note>
  The internal slot [[Pipeline]] of an entry can never be empty.
</emu-note>
<emu-note>
  Alternative, this algo can be implemented using functional programming techinques or a reverse cycle to avoid walking the entries twice.
</emu-note>
   <p>An <dfn data-dfn-type="dfn" data-noexport="" id="stage-entry">stage<a class="self-link" href="#stage-entry"></a></dfn> is a record with the following fields:</p>
   <table>
    <thead>
     <tr>
      <th>Internal Slot
      </th><th>Value Type (<em>non-normative</em>)
      </th><th>Description (<em>non-normative</em>)
    </th></tr></thead><tbody>
     <tr>
      <td>[[Stage]]
      </td><td><code>"fetch"</code>, <code>"translate"</code>, <code>"instantiate"</code>, <code>"satisfy"</code>, <code>"link"</code>, <code>"ready"</code>
      </td><td>A constant value to indicating which phase the entry is at.
     </td></tr><tr>
      <td>[[Result]]
      </td><td>Promise or <code>undefined</code>
      </td><td>A promise for the stage entry.
   </td></tr></tbody></table>
   <p>Each [[Stage]] value indicates the currently pending operation. If the [[Result]] field is *undefined*, the operation has not been initiated; if the [[Result]] field is a promise, the operation has been initiated but not completed. Once a stage completes, its Stage Entry is removed from the pipeline. The following table describes the intended purpose of each stage of the pipeline:</p>
   <table>
    <thead>
     <tr>
      <th>Value
      </th><th>Description (<em>non-normative</em>)
    </th></tr></thead><tbody>
     <tr>
      <td><code>"fetch"</code>
      </td><td>fetching the requested module (e.g. from a filesystem or network)
     </td></tr><tr>
      <td><code>"translate"</code>
      </td><td>translating the fetched source (as via a preprocessor or compiler)
     </td></tr><tr>
      <td><code>"instantiate"</code>
      </td><td>instantiating the translated source as a Module Record
     </td></tr><tr>
      <td><code>"satisfy"</code>
      </td><td>satisfying the module’s dependency graph by instantiating all of its (direct or indirect) dependencies
     </td></tr><tr>
      <td><code>"link"</code>
      </td><td>linking all imports and exports of the module’s dependency graph
     </td></tr><tr>
      <td><code>"ready"</code>
      </td><td>fully loaded and initialized
   </td></tr></tbody></table>
   <h3 class="heading settled" data-level="5.2" id="module-status-constructor"><span class="secno">5.2. </span><span class="content">The ModuleStatus Constructor</span><a class="self-link" href="#module-status-constructor"></a></h3>
   <p>The ModuleStatus constructor is the %ModuleStatus% intrinsic object and the initial value of the <b>Status</b> property of the Reflect.Module object. When called as a constructor it creates and initializes a new ModuleStatus object. When <b>ModuleStatus</b> is called as a function rather than as a constructor, it throws an exception.</p>
   <p>The <b>ModuleStatus</b> constructor is designed to be subclassable. It may be used as the value of an <b>extends</b> clause of a class definition. Subclass constructors that intend to inherit the specified <b>ModuleStatus</b> behaviour must include a <b>super</b> call to the <b>ModuleStatus</b> constructor to create and initialize the subclass instance with the corresponding internal slots.</p>
   <h4 aoid="ModuleStatus" class="heading settled" data-level="5.2.1" id="new-module-status"><span class="secno">5.2.1. </span><span class="content">ModuleStatus(loader, key)</span><a class="self-link" href="#new-module-status"></a></h4>
   <p>When ModuleStatus is called with arguments <i>loader</i> and <i>key</i>, the following steps are taken:</p>
<emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, then throw a <emu-val>TypeError</emu-val> exception.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>loader</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>loader</var> does not have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>keyString</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(<var>key</var>).</li><li>Let <var>O</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a>(NewTarget, "%ModuleStatusPrototype%", «[[Loader]], [[Pipeline]], [[Key]], [[Module]], [[Metadata]], [[Dependencies]], [[Error]]» ).</li><li>Let <var>pipeline</var> be a new List.</li><li>Add new stage entry record { [[Stage]]: "fetch", [[Result]]: <emu-val>undefined</emu-val> } as a new element of the list <var>pipeline</var>.</li><li>Add new stage entry record { [[Stage]]: "translate", [[Result]]: <emu-val>undefined</emu-val> } as a new element of the list <var>pipeline</var>.</li><li>Add new stage entry record { [[Stage]]: "instantiate", [[Result]]: <emu-val>undefined</emu-val> } as a new element of the list <var>pipeline</var>.</li><li>Add new stage entry record { [[Stage]]: "satisfy", [[Result]]: <emu-val>undefined</emu-val> } as a new element of the list <var>pipeline</var>.</li><li>Add new stage entry record { [[Stage]]: "link", [[Result]]: <emu-val>undefined</emu-val> } as a new element of the list <var>pipeline</var>.</li><li>Add new stage entry record { [[Stage]]: "ready", [[Result]]: <emu-val>undefined</emu-val> } as a new element of the list <var>pipeline</var>.</li><li>Set <var>O</var>’s [[Loader]] internal slot to <var>loader</var>.</li><li>Set <var>O</var>’s [[Pipeline]] internal slot to <var>pipeline</var>.</li><li>Set <var>O</var>’s [[Key]] internal slot to <var>keyString</var>.</li><li>Set <var>O</var>’s [[Module]] internal slot to <emu-val>undefined</emu-val>.</li><li>Set <var>O</var>’s [[Metadata]] internal slot to <emu-val>undefined</emu-val>.</li><li>Set <var>O</var>’s [[Dependencies]] internal slot to <emu-val>undefined</emu-val>.</li><li>Set <var>O</var>’s [[Error]] internal slot to <emu-val>false</emu-val>.</li><li>Return <var>O</var>.</li></ol></emu-alg>
<emu-note>
  A module status is associated to a loader instance at the time of its creation, the [[Loader]] backpointer reflects that.
</emu-note>
<emu-note>
  The optional second argument module allows to create a module status in a way that synchronously circumvents the asynchronous loading process.
</emu-note>
<emu-note>
  A module status can be set into multiple Registry instances.
</emu-note>
   <h3 class="heading settled" data-level="5.3" id="properties-of-the-module-status-constructor"><span class="secno">5.3. </span><span class="content">Properties of the ModuleStatus Constructor</span><a class="self-link" href="#properties-of-the-module-status-constructor"></a></h3>
   <p>The value of the [[Prototype]] internal slot of the Registry constructor is the intrinsic object %FunctionPrototype%.</p>
   <p>Besides the internal slots and the length property (whose value is 0), the ModuleStatus constructor has the following properties:</p>
   <h4 class="heading settled" data-level="5.3.1" id="module-status-prototype"><span class="secno">5.3.1. </span><span class="content">ModuleStatus.prototype</span><a class="self-link" href="#module-status-prototype"></a></h4>
   <p>The initial value of ModuleStatus.prototype is the intrinsic object %ModuleStatusPrototype%.</p>
   <p>This property has the attributes { [[Writable]]: false, [[Enumerable]]: false, [[Configurable]]: false }.</p>
   <h3 class="heading settled" data-level="5.4" id="module-status-prototype-object"><span class="secno">5.4. </span><span class="content">Properties of the ModuleStatus Prototype Object</span><a class="self-link" href="#module-status-prototype-object"></a></h3>
   <h4 class="heading settled" data-level="5.4.1" id="module-status-prototype-constructor"><span class="secno">5.4.1. </span><span class="content">ModuleStatus.prototype.constructor</span><a class="self-link" href="#module-status-prototype-constructor"></a></h4>
   <p>The initial value of ModuleStatus.prototype.constructor is the intrinsic object %ModuleStatus%.</p>
   <h4 class="heading settled" data-level="5.4.2" id="module-status-stage"><span class="secno">5.4.2. </span><span class="content">get ModuleStatus.prototype.stage</span><a class="self-link" href="#module-status-stage"></a></h4>
   <p><code>ModuleStatus.prototype.stage</code> is an accessor property whose set accessor function is undefined. Its get accessor function performs the following steps:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>stageEntry</var> be <a href="#module-status-IsValidStageValue">GetCurrentStage</a>(<var>entry</var>).</li><li>Return <var>stageEntry</var>.[[Stage]].</li></ol></emu-alg>
   <h4 class="heading settled" data-level="5.4.3" id="module-status-module"><span class="secno">5.4.3. </span><span class="content">get ModuleStatus.prototype.originalKey</span><a class="self-link" href="#module-status-module"></a></h4>
   <p><code>ModuleStatus.prototype.originalKey</code> is an accessor property whose set accessor function is undefined. Its get accessor function performs the following steps:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Return <var>entry</var>.[[Key]].</li></ol></emu-alg>
   <h4 class="heading settled" data-level="5.4.4" id="module-status-module0"><span class="secno">5.4.4. </span><span class="content">get ModuleStatus.prototype.module</span><a class="self-link" href="#module-status-module0"></a></h4>
   <p><code>ModuleStatus.prototype.module</code> is an accessor property whose set accessor function is undefined. Its get accessor function performs the following steps:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>module</var> be <var>entry</var>.[[Module]].</li><li>If <var>module</var> is a Module Record, return GetModuleNamespace(<var>module</var>).</li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
   <h4 class="heading settled" data-level="5.4.5" id="module-status-error"><span class="secno">5.4.5. </span><span class="content">get ModuleStatus.prototype.error</span><a class="self-link" href="#module-status-error"></a></h4>
   <p><code>ModuleStatus.prototype.error</code> is an accessor property whose set accessor function is undefined. Its get accessor function performs the following steps:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Return <var>entry</var>.[[Error]].</li></ol></emu-alg>
   <h4 class="heading settled" data-level="5.4.6" id="module-status-error0"><span class="secno">5.4.6. </span><span class="content">get ModuleStatus.prototype.dependencies</span><a class="self-link" href="#module-status-error0"></a></h4>
   <p><code>ModuleStatus.prototype.dependencies</code> is an accessor property whose set accessor function is undefined. Its get accessor function performs the following steps:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>array</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-arraycreate">ArrayCreate</a>(0).</li><li>Let <var>n</var> be 0.</li><li>For each <var>pair</var> in <var>entry</var>.[[Dependencies]], do:<ol><li>Let <var>O</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-objectcreate">ObjectCreate</a>(%ObjectPrototype%).</li><li>Let <var>requestNameDesc</var> be the PropertyDescriptor{[[Value]]: <var>pair</var>.[[RequestName]], [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>true</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}.</li><li>Perform ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-definepropertyorthrow">DefinePropertyOrThrow</a>(<var>O</var>, "requestName", <var>requestNameDesc</var>).</li><li>Let <var>moduleStatusDesc</var> be the PropertyDescriptor{[[Value]]: <var>pair</var>.[[ModuleStatus]], [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>true</emu-val>, [[Configurable]]: <emu-val>false</emu-val>}.</li><li>Perform ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-definepropertyorthrow">DefinePropertyOrThrow</a>(<var>O</var>, "entry", <var>moduleStatusDesc</var>).</li><li>Perform ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-createdataproperty">CreateDataProperty</a>(<var>array</var>, ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(<var>n</var>), <var>O</var>).</li><li>Increment <var>n</var> by 1.</li></ol></li><li>Return <var>array</var>.</li></ol></emu-alg>
<emu-note>
  The dependencies accessor provides access to the dependency graph, exposing each dependency’s requestName, key and entry reference.
</emu-note>
   <h4 class="heading settled" data-level="5.4.7" id="module-status-prototype-load"><span class="secno">5.4.7. </span><span class="content">ModuleStatus.prototype.load(stage)</span><a class="self-link" href="#module-status-prototype-load"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>If <var>stage</var> is <emu-val>undefined</emu-val>, let <var>stageValue</var> be "fetch"; otherwise, let <var>stageValue</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(<var>stage</var>).</li><li><a href="#reject-if-abrupt">RejectIfAbrupt</a>(<var>stageValue</var>).</li><li>If IsValidStageValue(<var>stageValue</var>) is <emu-val>false</emu-val>, return a promise rejected with a new <emu-val>RangeError</emu-val> exception.</li><li>Return <a href="#module-status-LoadModule">LoadModule</a>(<var>entry</var>, <var>stageValue</var>).</li></ol></emu-alg>
   <h4 class="heading settled" data-level="5.4.8" id="module-status-prototype-result"><span class="secno">5.4.8. </span><span class="content">ModuleStatus.prototype.result(stage)</span><a class="self-link" href="#module-status-prototype-result"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>Let <var>stageValue</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(<var>stage</var>).</li><li><a href="#reject-if-abrupt">RejectIfAbrupt</a>(<var>stageValue</var>).</li><li>If IsValidStageValue(<var>stageValue</var>) is <emu-val>false</emu-val>, return a promise rejected with a new <emu-val>RangeError</emu-val> exception.</li><li>Let <var>stageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, <var>stageValue</var>).</li><li>If <var>stageEntry</var> is <emu-val>undefined</emu-val>, return a promise resolved with <emu-val>undefined</emu-val>.</li><li>If <var>stageEntry</var>.[[Result]] is <emu-val>undefined</emu-val>, return a promise resolved with <emu-val>undefined</emu-val>.</li><li>Return the result of transforming <var>stageEntry</var>.[[Result]] with a new pass-through promise.</li></ol></emu-alg>
   <h4 class="heading settled" data-level="5.4.9" id="module-status-prototype-resolve"><span class="secno">5.4.9. </span><span class="content">ModuleStatus.prototype.resolve(stage, result)</span><a class="self-link" href="#module-status-prototype-resolve"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>Let <var>stageValue</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(<var>stage</var>).</li><li><a href="#reject-if-abrupt">RejectIfAbrupt</a>(<var>stageValue</var>).</li><li>If IsValidStageValue(<var>stageValue</var>) is <emu-val>false</emu-val>, return a promise rejected with a new <emu-val>RangeError</emu-val> exception.</li><li>Let <var>p0</var> be the result of transforming <var>result</var> with a new pass-through promise.</li><li>Let <var>p1</var> be the result of transforming <var>p0</var> with a fulfillment handler that, when called with argument <var>value</var>, runs the following steps:<ol><li>Let <var>stageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, <var>stageValue</var>).</li><li>If <var>stageEntry</var> is <emu-val>undefined</emu-val>, throw a new <emu-val>TypeError</emu-val>.</li><li>If <var>stageEntry</var>.[[Result]] is <emu-val>undefined</emu-val>, then<ol><li>Set <var>stageEntry</var>.[[Result]] to a promise resolved with <var>value</var>.</li></ol></li><li>Else,<ol><li>Fulfill <var>stageEntry</var>.[[Result]] with <var>value</var>.</li></ol></li><li>Perform <a href="#module-status-UpgradeToStage">UpgradeToStage</a>(<var>entry</var>, <var>stageValue</var>).</li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p1</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Return <var>p1</var>.</li></ol></emu-alg>
   <h4 class="heading settled" data-level="5.4.10" id="module-status-prototype-reject"><span class="secno">5.4.10. </span><span class="content">ModuleStatus.prototype.reject(stage, error)</span><a class="self-link" href="#module-status-prototype-reject"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>entry</var> be <emu-val>this</emu-val> value.</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>entry</var>) is not Object, return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>If <var>entry</var> does not have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>), return a promise rejected with a new <emu-val>TypeError</emu-val> exception.</li><li>Let <var>stageValue</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(<var>stage</var>).</li><li><a href="#reject-if-abrupt">RejectIfAbrupt</a>(<var>stageValue</var>).</li><li>If IsValidStageValue(<var>stageValue</var>) is <emu-val>false</emu-val>, return a promise rejected with a new <emu-val>RangeError</emu-val> exception.</li><li>Let <var>p0</var> be the result of transforming <var>error</var> with a new pass-through promise.</li><li>Let <var>p1</var> be the result of transforming <var>p0</var> with a fulfillment handler that, when called with argument <var>value</var>, runs the following steps:<ol><li>Let <var>stageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, <var>stageValue</var>).</li><li>If <var>stageEntry</var> is <emu-val>undefined</emu-val>, throw a new <emu-val>TypeError</emu-val>.</li><li>If <var>stageEntry</var>.[[Result]] is <emu-val>undefined</emu-val>, then<ol><li>Set <var>stageEntry</var>.[[Result]] to a promise rejected with <var>value</var>.</li></ol></li><li>Else,<ol><li>Reject <var>stageEntry</var>.[[Result]] with <var>value</var>.</li></ol></li><li>Perform <a href="#module-status-UpgradeToStage">UpgradeToStage</a>(<var>entry</var>, <var>stageValue</var>).</li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p1</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Return <var>p1</var>.</li></ol></emu-alg>
   <h3 class="heading settled" data-level="5.5" id="module-status-internal-slots"><span class="secno">5.5. </span><span class="content">Properties of ModuleStatus Instances</span><a class="self-link" href="#module-status-internal-slots"></a></h3>
   <p>ModuleStatus instances are ordinary objects that inherit properties from the %ModuleStatusPrototype%.</p>
   <p>ModuleStatus instances are initially created with the internal slots described in the following table:</p>
   <table>
    <thead>
     <tr>
      <th>Internal Slot
      </th><th>Value Type (<em>non-normative</em>)
      </th><th>Description (<em>non-normative</em>)
    </th></tr></thead><tbody>
     <tr>
      <td>[[Loader]]
      </td><td>An object
      </td><td>The loader this module status belongs to.
     </td></tr><tr>
      <td>[[Pipeline]]
      </td><td>A List
      </td><td>A list whose elements are stage records.
     </td></tr><tr>
      <td>[[Key]]
      </td><td>A String
      </td><td>A value that identifies what key was used to create the module status instance.
     </td></tr><tr>
      <td>[[Metadata]]
      </td><td>Object or <code>undefined</code>
      </td><td>The metadata object passed through the pipeline.
     </td></tr><tr>
      <td>[[Dependencies]]
      </td><td>List of Records of the form {[[RequestName]]: String, [[ModuleStatus]]: Module Status} .
      </td><td>Table mapping unresolved names to their resolved key and module status entries.
     </td></tr><tr>
      <td>[[Module]]
      </td><td>Module Record or Function object or <code>undefined</code>
      </td><td>The Module Record if the entry is ready, or a thunk if the entry is delayed; otherwise <code>undefined</code>.
     </td></tr><tr>
      <td>[[Error]]
      </td><td>A Boolean
      </td><td>A boolean valued that if <b>true</b> indicates that an error that was encountered during one of the phases of the loading pipeline; <b>false</b> if no error has been encountered.
   </td></tr></tbody></table>
   <h2 class="heading settled" data-level="6" id="pipeline-semantics"><span class="secno">6. </span><span class="content">Loading Semantics</span><a class="self-link" href="#pipeline-semantics"></a></h2>
   <h3 class="heading settled" data-level="6.1" id="auxiliary-operations"><span class="secno">6.1. </span><span class="content">Auxiliary Operations</span><a class="self-link" href="#auxiliary-operations"></a></h3>
   <h4 aoid="EnsureRegistered" class="heading settled" data-level="6.1.1" id="ensure-registered"><span class="secno">6.1.1. </span><span class="content">EnsureRegistered(loader, key)</span><a class="self-link" href="#ensure-registered"></a></h4>
<emu-alg><ol><li>Assert: <var>loader</var> must have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>).</li><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>key</var>) is String.</li><li>Let <var>registry</var> be <var>loader</var>.[[Registry]].</li><li>Let <var>pair</var> be the entry in <var>registry</var>.[[RegistryMap]] such that <var>pair</var>.[[Key]] is equal to <var>key</var>.</li><li>If <var>pair</var> exists, then:<ol><li>Let <var>entry</var> be <var>pair</var>.[[Value]].</li></ol></li><li>Else,<ol><li>Let <var>entry</var> be a new <a href="#new-module-status">ModuleStatus</a>(<var>loader</var>, <var>key</var>).</li></ol></li><li>Return <var>entry</var>.</li></ol></emu-alg>
   <h4 aoid="Resolve" class="heading settled" data-level="6.1.2" id="resolve"><span class="secno">6.1.2. </span><span class="content">Resolve(loader, name, referrer)</span><a class="self-link" href="#resolve"></a></h4>
<emu-alg><ol><li>Assert: <var>loader</var> must have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>).</li><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>name</var>) is String.</li><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>referrer</var>) is String.</li><li>Let <var>hook</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-getmethod">GetMethod</a>(<var>loader</var>, @@resolve).</li><li>Return the result of promise-calling <var>hook</var>(<var>name</var>, <var>referrer</var>).</li></ol></emu-alg>
   <h4 aoid="ExtractDependencies" class="heading settled" data-level="6.1.3" id="extract-dependencies"><span class="secno">6.1.3. </span><span class="content">ExtractDependencies(entry, optionalInstance, source)</span><a class="self-link" href="#extract-dependencies"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>instance</var> be ? <a href="#instantiation">Instantiation</a>(<var>entry</var>.[[Loader]], <var>optionalInstance</var>, <var>source</var>).</li><li>Let <var>deps</var> be a new empty List.</li><li>If <var>instance</var> is a Module Record, then:<ol><li>Assert: <var>instance</var> is a Source Text Module Record.</li><li>Set <var>instance</var>.[[ModuleStatus]] to <var>entry</var>.</li><li>For each <var>dep</var> in <var>instance</var>.[[RequestedModules]], do:<ol><li>Append the record { [[RequestName]]: <var>dep</var>, [[ModuleStatus]]: <emu-val>undefined</emu-val> } to <var>deps</var>.</li></ol></li></ol></li><li>Set <var>entry</var>.[[Dependencies]] to <var>deps</var>.</li><li>Set <var>entry</var>.[[Module]] to <var>instance</var>.</li></ol></emu-alg>
<emu-note>
  [[Key]] will identifies the dependency module status in the entry’s corresponding loader.
</emu-note>
   <h4 aoid="Instantiation" class="heading settled" data-level="6.1.4" id="instantiation"><span class="secno">6.1.4. </span><span class="content">Instantiation(loader, result, source)</span><a class="self-link" href="#instantiation"></a></h4>
<emu-alg><ol><li>Assert: <var>loader</var> must have all of the internal slots of a Loader Instance (<a href="#loader-internal-slots">3.5</a>).</li><li>If <var>result</var> is <emu-val>undefined</emu-val>, return ParseModule(<var>source</var>).</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-iscallable">IsCallable</a>(<var>result</var>) is <emu-val>false</emu-val> then throw a new <emu-val>TypeError</emu-val>.</li><li>Set <var>result</var>.[[Realm]] to <var>loader</var>.[[Realm]].</li><li>Return <var>result</var>.</li></ol></emu-alg>
   <h3 class="heading settled" data-level="6.2" id="loading-operations"><span class="secno">6.2. </span><span class="content">Loading Operations</span><a class="self-link" href="#loading-operations"></a></h3>
   <h4 aoid="RequestFetch" class="heading settled" data-level="6.2.1" id="request-fetch"><span class="secno">6.2.1. </span><span class="content">RequestFetch(entry)</span><a class="self-link" href="#request-fetch"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>fetchStageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, "fetch").</li><li>If <var>fetchStageEntry</var> is <emu-val>undefined</emu-val>, return a promise resolved with <emu-val>undefined</emu-val>.</li><li>If <var>fetchStageEntry</var>.[[Result]] is not <emu-val>undefined</emu-val>, return <var>fetchStageEntry</var>.[[Result]].</li><li>Let <var>hook</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-getmethod">GetMethod</a>(<var>entry</var>.[[Loader]], @@fetch).</li><li>Let <var>hookResult</var> be the result of promise-calling <var>hook</var>(<var>entry</var>, <var>entry</var>.[[Key]]).</li><li>Let <var>p</var> be the result of transforming <var>hookResult</var> with a fulfillment handler that, when called with argument <var>payload</var>, runs the following steps:<ol><li>Perform <a href="#module-status-UpgradeToStage">UpgradeToStage</a>(<var>entry</var>, "translate").</li><li>Return <var>payload</var>.</li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Set <var>fetchStageEntry</var>.[[Result]] to <var>p</var>.</li><li>Return <var>p</var>.</li></ol></emu-alg>
   <h4 aoid="RequestTranslate" class="heading settled" data-level="6.2.2" id="request-translate"><span class="secno">6.2.2. </span><span class="content">RequestTranslate(entry)</span><a class="self-link" href="#request-translate"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>translateStageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, "translate").</li><li>If <var>translateStageEntry</var> is <emu-val>undefined</emu-val>, return a promise resolved with <emu-val>undefined</emu-val>.</li><li>If <var>translateStageEntry</var>.[[Result]] is not <emu-val>undefined</emu-val>, return <var>translateStageEntry</var>.[[Result]].</li><li>Let <var>p</var> be the result of transforming <a href="#request-fetch">RequestFetch</a>(<var>entry</var>) with a fulfillment handler that, when called with argument <var>payload</var>, runs the following steps:<ol><li>Let <var>hook</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-getmethod">GetMethod</a>(<var>entry</var>.[[Loader]], @@translate).</li><li>Let <var>hookResult</var> be the result of promise-calling <var>hook</var>(<var>entry</var>, <var>payload</var>).</li><li>Return the result of transforming <var>hookResult</var> with a fulfillment handler that, when called with argument <var>source</var>, runs the following steps:<ol><li>Perform <a href="#module-status-UpgradeToStage">UpgradeToStage</a>(<var>entry</var>, "instantiate").</li><li>Return <var>source</var>.</li></ol></li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Set <var>translateStageEntry</var>.[[Result]] to <var>p</var>.</li><li>Return <var>p</var>.</li></ol></emu-alg>
   <h4 aoid="RequestInstantiate" class="heading settled" data-level="6.2.3" id="request-instantiate"><span class="secno">6.2.3. </span><span class="content">RequestInstantiate(entry)</span><a class="self-link" href="#request-instantiate"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>instantiateStageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, "instantiate").</li><li>If <var>instantiateStageEntry</var> is <emu-val>undefined</emu-val>, return a promise resolved with <emu-val>undefined</emu-val>.</li><li>If <var>instantiateStageEntry</var>.[[Result]] is not <emu-val>undefined</emu-val>, return <var>instantiateStageEntry</var>.[[Result]].</li><li>Let <var>p</var> be the result of transforming <a href="#request-translate">RequestTranslate</a>(<var>entry</var>) with a fulfillment handler that, when called with argument <var>source</var>, runs the following steps:<ol><li>Let <var>hook</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-getmethod">GetMethod</a>(<var>entry</var>.[[Loader]], @@instantiate).</li><li>Let <var>hookResult</var> be the result of promise-calling <var>hook</var>(<var>entry</var>, <var>source</var>).</li><li>Return the result of transforming <var>hookResult</var> with a fulfillment handler that, when called with argument <var>optionalInstance</var>, runs the following steps:<ol><li>Perform ? <a href="#extract-dependencies">ExtractDependencies</a>(<var>entry</var>, <var>optionalInstance</var>, <var>source</var>).</li><li>Perform <a href="#module-status-UpgradeToStage">UpgradeToStage</a>(<var>entry</var>, "satisfy").</li><li>Return <var>optionalInstance</var>.</li></ol></li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Set <var>instantiateStageEntry</var>.[[Result]] to <var>p</var>.</li><li>Return <var>p</var>.</li></ol></emu-alg>
   <h4 aoid="RequestSatisfy" class="heading settled" data-level="6.2.4" id="request-satisfy"><span class="secno">6.2.4. </span><span class="content">RequestSatisfy(entry)</span><a class="self-link" href="#request-satisfy"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>satisfyStageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, "satisfy").</li><li>If <var>satisfyStageEntry</var> is <emu-val>undefined</emu-val>, return a promise resolved with <emu-val>undefined</emu-val>.</li><li>If <var>satisfyStageEntry</var>.[[Result]] is not <emu-val>undefined</emu-val>, return <var>satisfyStageEntry</var>.[[Result]].</li><li>Let <var>p</var> be the result of transforming <a href="#request-instantiate">RequestInstantiate</a>(<var>entry</var>) with a fulfillment handler that, when called, runs the following steps:<ol><li>Let <var>depLoads</var> be a new empty List.</li><li>For each <var>pair</var> in <var>entry</var>.[[Dependencies]], do:<ol><li>Let <var>pp</var> be the result of transforming <a href="#resolve">Resolve</a>(<var>loader</var>, <var>pair</var>.[[RequestName]], <var>entry</var>.[[Key]]) with a fulfillment handler that, when called with value <var>depKey</var>, runs the following steps:<ol><li>Let <var>depEntry</var> be <a href="#ensure-registered">EnsureRegistered</a>(<var>entry</var>.[[Loader]], <var>depKey</var>).</li><li>Set <var>pair</var>.[[ModuleStatus]] to <var>depEntry</var>.</li><li>Let <var>currentStageEntry</var> be <a href="#module-status-IsValidStageValue">GetCurrentStage</a>(<var>entry</var>).</li><li>If <var>currentStageEntry</var>.[[Stage]] is "ready", return <emu-val>undefined</emu-val>.</li><li>Return <a href="#request-satisfy">RequestSatisfy</a>(<var>depEntry</var>).</li></ol></li><li>Append <var>pp</var> to <var>depLoads</var>.</li></ol></li><li>Return the result of waiting for all <var>depLoads</var> with a fulfillment handler that, when called, runs the following steps:<ol><li>Perform <a href="#module-status-UpgradeToStage">UpgradeToStage</a>(<var>entry</var>, "link").</li><li>Return <emu-val>undefined</emu-val>.</li></ol></li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Set <var>satisfyStageEntry</var>.[[Result]] to <var>p</var>.</li><li>Return <var>p</var>.</li></ol></emu-alg>
<emu-note>
  This abstract operation completes the [[Dependencies]] registry per entry keeping backpointers to each dependency entry and the corresponding keys.
</emu-note>
   <h4 aoid="RequestLink" class="heading settled" data-level="6.2.5" id="request-link"><span class="secno">6.2.5. </span><span class="content">RequestLink(entry)</span><a class="self-link" href="#request-link"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>linkStageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, "link").</li><li>If <var>linkStageEntry</var> is <emu-val>undefined</emu-val>, return a promise resolved with <emu-val>undefined</emu-val>.</li><li>If <var>linkStageEntry</var>.[[Result]] is not <emu-val>undefined</emu-val>, return <var>linkStageEntry</var>.[[Result]].</li><li>Let <var>p</var> be the result of transforming <a href="#request-satisfy">RequestSatisfy</a>(<var>entry</var>) with a fulfillment handler that, when called, runs the following steps:<ol><li>Assert: <var>entry</var>’s whole dependency graph is in "link" or "ready" stage.</li><li>Perform ? <a href="#link">Link</a>(<var>entry</var>).</li><li>Assert: <var>entry</var>’s whole dependency graph is in "ready" stage.</li><li>Return <emu-val>undefined</emu-val>.</li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Set <var>linkStageEntry</var>.[[Result]] to <var>p</var>.</li><li>Return <var>p</var>.</li></ol></emu-alg>
   <h4 aoid="RequestReady" class="heading settled" data-level="6.2.6" id="request-ready"><span class="secno">6.2.6. </span><span class="content">RequestReady(entry)</span><a class="self-link" href="#request-ready"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>readyStageEntry</var> be <a href="#module-status-GetStage">GetStage</a>(<var>entry</var>, "ready").</li><li>Assert: <var>readyStageEntry</var> is not <emu-val>undefined</emu-val>.</li><li>If <var>readyStageEntry</var>.[[Result]] is not <emu-val>undefined</emu-val>, return <var>readyStageEntry</var>.[[Result]].</li><li>Let <var>p</var> be the result of transforming <a href="#request-link">RequestLink</a>(<var>entry</var>) with a fulfillment handler that, when called, runs the following steps:<ol><li>Let <var>module</var> be <var>entry</var>.[[Module]].</li><li>Perform ? <var>module</var>.<a href="#module-evaluation">ModuleEvaluation</a>().</li><li>Return ? GetModuleNamespace(<var>module</var>).</li></ol></li><li>Let <var>pCatch</var> be the result of transforming <var>p</var> with a rejection handler that, when called, runs the following steps:<ol><li>Set <var>entry</var>.[[Error]] to <emu-val>true</emu-val>.</li></ol></li><li>Set <var>readyStageEntry</var>.[[Result]] to <var>p</var>.</li><li>Return <var>p</var>.</li></ol></emu-alg>
   <h2 class="heading settled" data-level="7" id="linking-semantics"><span class="secno">7. </span><span class="content">Linking Semantics</span><a class="self-link" href="#linking-semantics"></a></h2>
   <h3 class="heading settled" data-level="7.1" id="resolving-dependencies"><span class="secno">7.1. </span><span class="content">Resolving Dependencies</span><a class="self-link" href="#resolving-dependencies"></a></h3>
   <h4 aoid="HostResolveImportedModule" class="heading settled" data-level="7.1.1" id="host-resolve-imported-module"><span class="secno">7.1.1. </span><span class="content">HostResolveImportedModule(module, requestName)</span><a class="self-link" href="#host-resolve-imported-module"></a></h4>
   <p>The modules spec should only invoke this operation from methods of Source Text Module Records, and this spec does not invoke the operation at all.</p>
<emu-alg><ol><li>Assert: <var>module</var> is a Source Text Module Record.</li><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>requestName</var>) is String.</li><li>Let <var>entry</var> be <var>module</var>.[[ModuleStatus]].</li><li>Let <var>currentStageEntry</var> be <a href="#module-status-IsValidStageValue">GetCurrentStage</a>(<var>entry</var>).</li><li>Assert: <var>currentStageEntry</var>.[[Stage]] is in "link" or "ready" stage.</li><li>Let <var>pair</var> be the pair in <var>entry</var>.[[Dependencies]] such that <var>pair</var>.[[RequestName]] is equal to <var>requestName</var>.</li><li>Assert: <var>pair</var> is defined.</li><li>Let <var>depEntry</var> be <var>pair</var>.[[ModuleStatus]].</li><li>Let <var>depStageEntry</var> be <a href="#module-status-IsValidStageValue">GetCurrentStage</a>(<var>depEntry</var>).</li><li>Assert: <var>depStageEntry</var>.[[Stage]] is equal "link" or "ready" stage.</li><li>Return <var>depEntry</var>.[[Module]].</li></ol></emu-alg>
   <h3 class="heading settled" data-level="7.2" id="linking"><span class="secno">7.2. </span><span class="content">Linking</span><a class="self-link" href="#linking"></a></h3>
   <h4 aoid="Link" class="heading settled" data-level="7.2.1" id="link"><span class="secno">7.2.1. </span><span class="content">Link(root)</span><a class="self-link" href="#link"></a></h4>
<emu-alg><ol><li>Assert: <var>root</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>deps</var> be <a href="#dependency-graph">DependencyGraph</a>(<var>root</var>).</li><li>For each <var>dep</var> in <var>deps</var>, do:<ol><li>Let <var>depStageEntry</var> be <a href="#module-status-IsValidStageValue">GetCurrentStage</a>(<var>dep</var>).</li><li>If <var>dep</var>.[[Module]] is a Function object, then:<ol><li>Assert: <var>depStageEntry</var>.[[Stage]] is "link".</li><li>Let <var>func</var> be <var>dep</var>.[[Module]].</li><li>Let <var>argList</var> be a new empty List.</li><li>Let <var>ns</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-call-f-v-args">Call</a>(<var>func</var>, <emu-val>undefined</emu-val>, <var>argList</var>).</li><li>If <var>ns</var> is not a module namespace exotic object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Set <var>dep</var>.[[Module]] to <var>ns</var>.[[Module]].</li></ol></li></ol></li><li>Assert: the following sequence is guaranteed not to run any user code.</li><li>For each <var>dep</var> in <var>deps</var>, do:<ol><li>Let <var>depStageEntry</var> be <a href="#module-status-IsValidStageValue">GetCurrentStage</a>(<var>dep</var>).</li><li>If <var>depStageEntry</var>.[[Stage]] is "link", then:<ol><li>Let <var>module</var> be <var>dep</var>.[[Module]].</li><li>Assert: <var>module</var> is a Module Record.</li><li>Perform ? <var>module</var>.<a href="#module-declaration-instantiation">ModuleDeclarationInstantiation</a>().</li><li>Perform <a href="#module-status-UpgradeToStage">UpgradeToStage</a>(<var>dep</var>, "ready").</li></ol></li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
   <h4 aoid="DependencyGraph" class="heading settled" data-level="7.2.2" id="dependency-graph"><span class="secno">7.2.2. </span><span class="content">DependencyGraph(root)</span><a class="self-link" href="#dependency-graph"></a></h4>
<emu-alg><ol><li>Assert: <var>root</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Let <var>result</var> be a new empty List.</li><li>Call <a href="#compute-dependency-graph">ComputeDependencyGraph</a>(<var>root</var>, <var>result</var>).</li><li>Return <var>result</var>.</li></ol></emu-alg>
   <h4 aoid="ComputeDependencyGraph" class="heading settled" data-level="7.2.3" id="compute-dependency-graph"><span class="secno">7.2.3. </span><span class="content">ComputeDependencyGraph(entry, result)</span><a class="self-link" href="#compute-dependency-graph"></a></h4>
<emu-alg><ol><li>Assert: <var>entry</var> must have all of the internal slots of a ModuleStatus Instance (<a href="#module-status-internal-slots">5.5</a>).</li><li>Assert: <var>result</var> must be a List.</li><li>If <var>entry</var> is already in <var>result</var>, return <emu-val>undefined</emu-val>.</li><li>Insert <var>entry</var> as the first element of <var>result</var>.</li><li>For each <var>pair</var> in <var>entry</var>.[[Dependencies]], do:<ol><li>Assert: <var>pair</var>.[[ModuleStatus]] is defined.</li><li>Call <a href="#compute-dependency-graph">ComputeDependencyGraph</a>(<var>pair</var>.[[ModuleStatus]], <var>result</var>).</li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
   <h2 class="heading settled" data-level="8" id="module-objects"><span class="secno">8. </span><span class="content">Module Objects</span><a class="self-link" href="#module-objects"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="reflective-module-record"><span class="secno">8.1. </span><span class="content">Reflective Module Records</span><a class="self-link" href="#reflective-module-record"></a></h3>
   <p>A <dfn data-dfn-type="dfn" data-noexport="" id="reflective-module-record0">reflective module record<a class="self-link" href="#reflective-module-record0"></a></dfn> is a kind of module record. It extends</p>
   <table>
    <thead>
     <tr>
      <th>Internal Slot
      </th><th>Value Type (<em>non-normative</em>)
      </th><th>Description (<em>non-normative</em>)
    </th></tr></thead><tbody>
     <tr>
      <td>[[LocalExports]]
      </td><td>A List of Strings
      </td><td>The set of exported names stored in this module’s environment.
     </td></tr><tr>
      <td>[[IndirectExports]]
      </td><td>A List of pairs of String and {[[module]]: Module Record, [[bindingName]]: String}.
      </td><td>The set of re-exported bindings. This ensures that ResolveExport can fully resolve re-exports.
     </td></tr><tr>
      <td>[[RequestedModules]]
      </td><td>A List of Module Records.
      </td><td>The set of module records requested by re-exported bindings. This ensures that ModuleEvaluation can evaluate each requested module.
     </td></tr><tr>
      <td>[[Evaluate]]
      </td><td>A function object or <code>undefined</code>
      </td><td>A thunk to call when the the module is evaluated, or <code>undefined</code> if the module is already evaluated.
   </td></tr></tbody></table>
   <p>-</p>
   <h3 class="heading settled" data-level="8.2" id="module-abstract-operations"><span class="secno">8.2. </span><span class="content">Abstract Operations for Module Objects</span><a class="self-link" href="#module-abstract-operations"></a></h3>
   <p></p>
   <h4 aoid="ParseExportsDescriptors" class="heading settled" data-level="8.2.1" id="parse-exports-descriptors"><span class="secno">8.2.1. </span><span class="content">ParseExportsDescriptors(obj)</span><a class="self-link" href="#parse-exports-descriptors"></a></h4>
   <p>When ParseExportsDescriptors is called with argument <i>obj</i>, the following steps are taken:</p>
<emu-alg><ol><li>Assert: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>obj</var>) is an Object.</li><li>Let <var>props</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-toobject">ToObject</a>(Obj).</li><li>Let <var>keys</var> be ? <var>props</var>.[[OwnPropertyKeys]]().</li><li>Let <var>descriptors</var> be an empty List.</li><li>Repeat for each element <var>nextKey</var> of <var>keys</var> in List order,<ol><li>Let <var>propDesc</var> be ? props.[[GetOwnProperty]](<var>nextKey</var>).</li><li>If <var>propDesc</var> is not <emu-val>undefined</emu-val> and <var>propDesc</var>.[[Enumerable]] is <emu-val>true</emu-val>, then<ol><li>Let <var>descObj</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-get-o-p">Get</a>(<var>props</var>, <var>nextKey</var>).</li><li>Let <var>hasModule</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-hasproperty">HasProperty</a>(<var>descObj</var>, "module").</li><li>If <var>hasModule</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>ns</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-get-o-p">Get</a>(<var>descObj</var>, "module").</li><li>If <var>ns</var> is not a module namespace exotic object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>import</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring">ToString</a>(? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-get-o-p">Get</a>(<var>descObj</var>, "import")).</li><li>Let <var>desc</var> be a new Indirect Export Descriptor Record {[[Name]]: <var>nextKey</var>, [[Module]]: <var>ns</var>.[[Module]], [[Import]]: <var>import</var>}.</li></ol></li><li>Else,<ol><li>Let <var>hasValue</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-hasproperty">HasProperty</a>(<var>descObj</var>, "value").</li><li>If <var>hasValue</var> is <emu-val>true</emu-val>, let <var>value</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-get-o-p">Get</a>(<var>descObj</var>, "value").</li><li>Let <var>hasConst</var> be ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-hasproperty">HasProperty</a>(<var>descObj</var>, "const").</li><li>If <var>hasConst</var> is <emu-val>true</emu-val>, let <var>isConst</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-toboolean">ToBoolean</a>(? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-get-o-p">Get</a>(<var>descObj</var>, "const")).</li><li>If <var>isConst</var> is <emu-val>true</emu-val>, then<ol><li>If <var>hasValue</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>desc</var> be a new Immutable Export Descriptor Record {[[Name]]: <var>nextKey</var>, [[Value]]: <var>value</var>, [[Initialized]]: <emu-val>true</emu-val>}.</li></ol></li><li>Else,<ol><li>Let <var>desc</var> be a new Immutable Export Descriptor Record {[[Name]]: <var>nextKey</var>, [[Value]]: <emu-val>undefined</emu-val>, [[Initialized]]: <emu-val>false</emu-val>}.</li></ol></li></ol></li><li>Else,<ol><li>If <var>hasValue</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>desc</var> be a new Mutable Export Descriptor Record {[[Name]]: <var>nextKey</var>, [[Value]]: <var>value</var>, [[Initialized]]: <emu-val>true</emu-val>}.</li></ol></li><li>Else,<ol><li>Let <var>desc</var> be a new Mutable Export Descriptor Record {[[Name]]: <var>nextKey</var>, [[Value]]: <emu-val>undefined</emu-val>, [[Initialized]]: <emu-val>false</emu-val>}.</li></ol></li></ol></li></ol></li><li>Append <var>desc</var> to the end of <var>descriptors</var>.</li></ol></li></ol></li><li>Return <var>descriptors</var>.</li></ol></emu-alg>
<emu-note>
  Parse as in <a href="https://gist.github.com/dherman/fbf3077a2781df74b6d8">these examples</a>
  <ul>
    <li>uninitialized, mutable: <code>{ }</code>
    </li><li>uninitialized, immutable: <code>{ const: true }</code>
    </li><li>initialized, mutable: <code>{ value: 42 }</code>
    </li><li>initialized, immutable: <code>{ value: 42, const: true }</code>
    </li><li>re-export (immutable): <code>{ module: m, import: "foo" }</code>
  </li></ul>
</emu-note>
   <h4 aoid="CreateModuleMutator" class="heading settled" data-level="8.2.2" id="create-module-mutator"><span class="secno">8.2.2. </span><span class="content">CreateModuleMutator(module)</span><a class="self-link" href="#create-module-mutator"></a></h4>
<emu-alg><ol><li>Assert: <var>module</var> is a Reflective Module Records.</li><li>Let <var>mutator</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-objectcreate">ObjectCreate</a>(%ObjectPrototype%).</li><li>Let <var>env</var> be <var>module</var>.[[Environment]].</li><li>Let <var>envRec</var> be env’s environment record.</li><li>For each <var>name</var> in <var>module</var>.[[IndirectExports]], do:<ol><li>Let <var>g</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-makearggetter">MakeArgGetter</a>(<var>name</var>, <var>envRec</var>).</li><li>Let <var>indirectExportDesc</var> be the PropertyDescriptor{[[Get]]: <var>g</var>, [[Set]]: %ThrowTypeError%, [[Enumerable]]: true, [[Configurable]]: false}.</li><li>Perform ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-definepropertyorthrow">DefinePropertyOrThrow</a>(<var>mutator</var>, <var>name</var>, <var>indirectExportDesc</var>).</li></ol></li><li>For each <var>name</var> in <var>module</var>.[[LocalExports]], do:<ol><li>Assert: <var>mutator</var> does not already have a binding for <var>name</var>.</li><li>Let <var>g</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-makearggetter">MakeArgGetter</a>(<var>name</var>, <var>envRec</var>).</li><li>Let <var>p</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-makeargsetter">MakeArgSetter</a>(<var>name</var>, <var>envRec</var>).</li><li>Let <var>localExportDesc</var> be the PropertyDescriptor{[[Get]]: <var>g</var>, [[Set]]: <var>p</var>, [[Enumerable]]: true, [[Configurable]]: false}.</li><li>Perform ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-definepropertyorthrow">DefinePropertyOrThrow</a>(<var>mutator</var>, <var>name</var>, <var>localExportDesc</var>).</li></ol></li><li>Return <var>mutator</var>.</li></ol></emu-alg>
   <h4 aoid="GetExportNames" class="heading settled" data-level="8.2.3" id="get-export-names"><span class="secno">8.2.3. </span><span class="content">GetExportNames(exportStarStack)</span><a class="self-link" href="#get-export-names"></a></h4>
   <p>The following steps are taken:</p>
<emu-alg><ol><li>Let <var>module</var> be this Reflective Module Record.</li><li>Let <var>exports</var> be a new empty List.</li><li>For each <var>name</var> in <var>module</var>.[[LocalExports]], do:<ol><li>Append <var>name</var> to <var>exports</var>.</li></ol></li><li>For each <var>pair</var> in <var>module</var>.[[IndirectExports]], do:<ol><li>Append <var>pair</var>.[[Key]] to <var>exports</var>.</li></ol></li><li>Return <var>exports</var>.</li></ol></emu-alg>
   <h4 aoid="ResolveExport" class="heading settled" data-level="8.2.4" id="resolve-export"><span class="secno">8.2.4. </span><span class="content">ResolveExport(exportName, resolveStack, exportStarStack)</span><a class="self-link" href="#resolve-export"></a></h4>
<emu-alg><ol><li>Let <var>module</var> be this Reflective Module Record.</li><li>If <var>resolveStack</var> contains a record <var>r</var> such that <var>r</var>.[[module]] is equal to <var>module</var> and <var>r</var>.[[exportName]] is equal to <var>exportName</var>, then<ol><li>Assert: this is a circular import request.</li><li>Throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>Append the record {[[module]]: <var>module</var>, [[exportName]]: <var>exportName</var>} to <var>resolveStack</var>.</li><li>Let <var>localExports</var> be <var>module</var>.[[LocalExports]].</li><li>Let <var>pair</var> be the pair in <var>localExports</var> such that <var>pair</var>.[[Key]] is equal to <var>exportName</var>.</li><li>If <var>pair</var> is defined, then:<ol><li>Return the Record { [[module]]: <var>module</var>, [[bindingName]]: <var>exportName</var> }.</li></ol></li><li>Let <var>indirectExports</var> be <var>module</var>.[[IndirectExports]].</li><li>Let <var>pair</var> be the pair in <var>indirectExports</var> such that <var>pair</var>.[[Key]] is equal to <var>exportName</var>.</li><li>If <var>pair</var> is defined, return <var>pair</var>.[[Value]].</li><li>Return <emu-val>null</emu-val>.</li></ol></emu-alg>
   <h4 aoid="ModuleDeclarationInstantiation" class="heading settled" data-level="8.2.5" id="module-declaration-instantiation"><span class="secno">8.2.5. </span><span class="content">ModuleDeclarationInstantiation()</span><a class="self-link" href="#module-declaration-instantiation"></a></h4>
   <p>Reflective modules are always already instantiated.</p>
<emu-alg><ol><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
   <h4 aoid="ModuleEvaluation" class="heading settled" data-level="8.2.6" id="module-evaluation"><span class="secno">8.2.6. </span><span class="content">ModuleEvaluation()</span><a class="self-link" href="#module-evaluation"></a></h4>
<emu-alg><ol><li>Let <var>module</var> be this Reflective Module Record.</li><li>If <var>module</var>.[[Evaluated]] is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>func</var> be <var>module</var>.[[Evaluate]].</li><li>Set <var>module</var>.[[Evaluated]] to <emu-val>true</emu-val>.</li><li>Set <var>module</var>.[[Evaluate]] to <emu-val>undefined</emu-val>.</li><li>For each <var>requiredModule</var> in <var>module</var>.[[RequestedModules]], do:<ol><li>Assert: <var>requiredModule</var> is a Module Record.</li><li>Perform ? <var>requiredModule</var>.<a href="#module-evaluation">ModuleEvaluation</a>().</li></ol></li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-iscallable">IsCallable</a>(<var>func</var>) is <emu-val>true</emu-val>, then:<ol><li>Let <var>argList</var> be a new empty List.</li><li>Perform ? <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-call-f-v-args">Call</a>(func, <emu-val>undefined</emu-val>, argList).</li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
   <h3 class="heading settled" data-level="8.3" id="module-constructor"><span class="secno">8.3. </span><span class="content">The Module Constructor</span><a class="self-link" href="#module-constructor"></a></h3>
   <p>The Module constructor is the initial value of the Module property of the the Reflect object. When called as a constructor it creates and initializes a new Module object. Module is not intended to be called as a function and will throw an exception when called in that manner.</p>
   <p>The Module constructor is designed to be subclassable. It may be used as the value in an extends clause of a class definition. Subclass constructors that intend to inherit the specified Module behaviour must include a super call to the Module constructor to create and initialize the subclass instance with the internal stage necessary to integrated with loaders.</p>
   <h4 class="heading settled" data-level="8.3.1" id="new-module"><span class="secno">8.3.1. </span><span class="content">Module(descriptors[, executor[, evaluate]])</span><a class="self-link" href="#new-module"></a></h4>
   <p>When Module is called with arguments <i>descriptors</i>, <i>executor</i>, and <i>evaluate</i>, the following steps are taken:</p>
<emu-alg><ol><li>Let <var>realm</var> be the current Realm.</li><li>Let <var>env</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-newmoduleenvironment">NewModuleEnvironment</a>(<var>realm</var>.[[globalEnv]]).</li><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-ecmascript-data-types-and-values">Type</a>(<var>descriptors</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>exportDescriptors</var> be <a href="#parse-exports-descriptors">ParseExportsDescriptors</a>(<var>descriptors</var>). // TODO: interleave the subsequent loop with parsing?</li><li>Let <var>localExports</var> be a new empty List.</li><li>Let <var>indirectExports</var> be a new empty List.</li><li>Let <var>exportNames</var> be a new empty List.</li><li>Let <var>requestedModules</var> be new empty List.</li><li>Let <var>envRec</var> be <var>env</var>’s environment record.</li><li>For each <var>desc</var> in <var>exportDescriptors</var>, do:<ol><li>Let <var>exportName</var> be <var>desc</var>.[[Name]].</li><li>Append <var>exportName</var> to <var>exportNames</var>.</li><li>If <var>desc</var> is an Indirect Export Descriptor, then:<ol><li>Let <var>otherMod</var> be <var>desc</var>.[[Module]].</li><li>If <var>requestedModules</var> does not contain the value of <var>otherMod</var>, then:<ol><li>Append <var>otherMod</var> to <var>requestedModules</var>.</li></ol></li><li>Let <var>resolution</var> be ? <var>otherMod</var>.<a href="#resolve-export">ResolveExport</a>(<var>desc</var>.[[Import]], « »).</li><li>If <var>resolution</var> is <emu-val>null</emu-val>, then throw a <emu-val>SyntaxError</emu-val> exception.</li><li>Append the record {[[Key]]: <var>exportName</var>, [[Value]]: <var>resolution</var>} to <var>indirectExports</var>.</li></ol></li><li>Else,<ol><li>Append <var>exportName</var> to <var>localExports</var>.</li><li>If <var>desc</var> is an Immutable Export Descriptor, then:<ol><li>Perform ? <var>envRec</var>.CreateImmutableBinding(<var>exportName</var>, <emu-val>true</emu-val>).</li></ol></li><li>Else,<ol><li>Assert: <var>desc</var> is a Mutable Export Descriptor.</li><li>Perform ? <var>envRec</var>.CreateMutableBinding(<var>exportName</var>, <emu-val>false</emu-val>).</li></ol></li><li>If <var>desc</var>.[[Initialized]] is <emu-val>true</emu-val>, then:<ol><li>Call <var>envRec</var>.InitializeBinding(<var>exportName</var>, <var>desc</var>.[[Value]]).</li></ol></li></ol></li></ol></li><li>If <var>evaluate</var> is not <emu-val>undefined</emu-val>, then<ol><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-iscallable">IsCallable</a>(<var>evaluate</var>) is <emu-val>false</emu-val>, throw a new <emu-val>TypeError</emu-val> exception.</li></ol></li><li>Let <var>mod</var> be a new Reflective Module Record {[[Realm]]: <var>realm</var>, [[Environment]]: <var>env</var>, [[Namespace]]: <emu-val>undefined</emu-val>, [[LocalExports]]: <var>localExports</var>, [[IndirectExports]]: <var>indirectExports</var>, [[RequestedModules]]: <var>requestedModules</var>, [[Evaluated]]: <emu-val>false</emu-val>, [[Evaluate]]: <var>evaluate</var>}.</li><li>Let <var>ns</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-modulenamespacecreate">ModuleNamespaceCreate</a>(<var>mod</var>, <var>realm</var>, <var>exportNames</var>).</li><li>Set <var>mod</var>.[[Namespace]] to <var>ns</var>.</li><li>If <var>executor</var> is not <emu-val>undefined</emu-val>, then<ol><li>If <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-iscallable">IsCallable</a>(<var>executor</var>) is <emu-val>false</emu-val>, throw a new <emu-val>TypeError</emu-val> exception.</li><li>Let <var>mutator</var> be <a href="#create-module-mutator">CreateModuleMutator</a>(<var>mod</var>).</li><li>Perform ? <var>executor</var>(<var>mutator</var>, <var>ns</var>).</li></ol></li><li>Return <var>ns</var>.</li></ol></emu-alg>
   <h3 class="heading settled" data-level="8.4" id="properties-of-the-module-constructor"><span class="secno">8.4. </span><span class="content">Properties of the Module Constructor</span><a class="self-link" href="#properties-of-the-module-constructor"></a></h3>
   <p>The value of the [[Prototype]] internal slot of the Module constructor is the intrinsic object %FunctionPrototype%.</p>
   <p>Besides the internal slots and the length property (whose value is 0), the Loader constructor has the following properties:</p>
   <h4 class="heading settled" data-level="8.4.1" id="Module.evaluate"><span class="secno">8.4.1. </span><span class="content">Module.evaluate(m)</span><a class="self-link" href="#Module.evaluate"></a></h4>
   <p><b>TODO:</b> way to force evaluation of a module namespace exotic object (<code>Reflect.Module.evaluate(m)</code>? <code>m[Reflect.Module.evaluate]()</code>?)</p>
   <h4 class="heading settled" data-level="8.4.2" id="Module.prototype"><span class="secno">8.4.2. </span><span class="content">Module.prototype</span><a class="self-link" href="#Module.prototype"></a></h4>
   <p>The value of Module.prototype is an ordinary object with a null [[Prototype]].</p>
   <p>This property has the attributes { [[Writable]]: false, [[Enumerable]]: false, [[Configurable]]: false }.</p>
   <h3 class="heading settled" data-level="8.5" id="module-internal-slots"><span class="secno">8.5. </span><span class="content">Properties of Module Instances</span><a class="self-link" href="#module-internal-slots"></a></h3>
   <p>Module instances are module namespace exotic objects.</p>
   <h2 class="heading settled" data-level="9" id="local"><span class="secno">9. </span><span class="content">Local Loading</span><a class="self-link" href="#local"></a></h2>
   <p><b>TODO:</b></p>
   <ul>
    <li>syntax for accessing module local information: <code>import local from this;</code> 
    </li><li>dynamic import: <code>local.import()</code> 
    </li><li>extending the hooks to handle <code>this</code> 
    </li><li>debugging info 
    </li><li>room for host environment-specific data 
   </li></ul>
   <h2 class="heading settled" data-level="10" id="browser"><span class="secno">10. </span><span class="content">Browser Loader</span><a class="self-link" href="#browser"></a></h2>
   <p>Every host environment must implement a default loader object as the initial value of the loader property of the System object.</p>
   <h3 class="heading settled" data-level="10.1" id="system-loader-instance"><span class="secno">10.1. </span><span class="content">System.loader Object</span><a class="self-link" href="#system-loader-instance"></a></h3>
   <p>The Default Browser Loader Object is an %BrowserLoader% instance, whose internal slots are set as if it had been constructed by the expression Construct(%BrowserLoader%).</p>
   <h2 class="heading settled" data-level="11" id="browser-loader"><span class="secno">11. </span><span class="content">BrowserLoader Objects</span><a class="self-link" href="#browser-loader"></a></h2>
   <h3 class="heading settled" data-level="11.1" id="browser-loader-constructor"><span class="secno">11.1. </span><span class="content">The BrowserLoader Constructor</span><a class="self-link" href="#browser-loader-constructor"></a></h3>
   <p>The BrowserLoader constructor is the %BrowserLoader% intrinsic object. When called as a constructor it creates and initializes a new BrowserLoader object. When <b>BrowserLoader</b> is called as a function rather than as a constructor, it throws an exception.</p>
   <h3 class="heading settled" data-level="11.2" id="properties-of-the-browser-loader-constructor"><span class="secno">11.2. </span><span class="content">Properties of the BrowserLoader Constructor</span><a class="self-link" href="#properties-of-the-browser-loader-constructor"></a></h3>
   <p>The value of the [[Prototype]] internal slot of the BrowserLoader constructor is the intrinsic object %FunctionPrototype%.</p>
   <p>Besides the internal slots and the length property (whose value is 0), the BrowserLoader constructor has the following properties:</p>
   <h4 class="heading settled" data-level="11.2.1" id="browser-loader-prototype"><span class="secno">11.2.1. </span><span class="content">BrowserLoader.prototype</span><a class="self-link" href="#browser-loader-prototype"></a></h4>
   <p>The initial value of BrowserLoader.prototype is the intrinsic object %BrowserLoaderPrototype%.</p>
   <p>This property has the attributes { [[Writable]]: false, [[Enumerable]]: false, [[Configurable]]: false }.</p>
   <h3 class="heading settled" data-level="11.3" id="properties-of-the-browser-loader-prototype"><span class="secno">11.3. </span><span class="content">Properties of the BrowserLoader Prototype</span><a class="self-link" href="#properties-of-the-browser-loader-prototype"></a></h3>
   <h4 class="heading settled" data-level="11.3.1" id="browser-loader-prototype-@@resolve"><span class="secno">11.3.1. </span><span class="content">BrowserLoader.prototype[ @@resolve ](name, referrer)</span><a class="self-link" href="#browser-loader-prototype-%40%40resolve"></a></h4>
   <p>When the @@resolve method is called, the following steps are taken:</p>
   <p><b>TODO:</b> name resolution policy</p>
   <ul>
    <li>relative and site-relative URLs: <code>"./utils.js"</code>, <code>"/scripts/utils.js"</code> 
    </li><li>JS standard modules: <code>"std/math"</code>, <code>"std/json"</code>, <code>"std/reflect"</code> 
    </li><li>Web standard modules: <code>"web/worker"</code>, <code>"web/audio"</code> 
    </li><li>absolute URLs: <code>"https://cdn.example.com/jquery/v/2.0"</code> 
   </li></ul>
   <p>The value of the name property of this function is "[Reflect.Loader.resolve]".</p>
   <h4 class="heading settled" data-level="11.3.2" id="browser-loader-prototype-@@fetch"><span class="secno">11.3.2. </span><span class="content">BrowserLoader.prototype[ @@fetch ](entry, key)</span><a class="self-link" href="#browser-loader-prototype-%40%40fetch"></a></h4>
   <p>When the @@fetch method is called, the following steps are taken:</p>
   <p><b>TODO:</b></p>
   <ul>
    <li>reference fetch standard 
    </li><li>cross-origin produces an opaque object as in ServiceWorker 
    </li><li>CORS, CSP 
    </li><li>other kinds of web assets 
   </li></ul>
   <p>The value of the name property of this function is "[Reflect.Loader.fetch]".</p>
   <h4 class="heading settled" data-level="11.3.3" id="browser-loader-prototype-@@translate"><span class="secno">11.3.3. </span><span class="content">BrowserLoader.prototype[ @@translate ](entry, payload)</span><a class="self-link" href="#browser-loader-prototype-%40%40translate"></a></h4>
   <p>When the @@translate method is called, the following steps are taken:</p>
   <p><b>TODO:</b> no-op.</p>
   <p>The value of the name property of this function is "[Reflect.Loader.translate]".</p>
   <h4 class="heading settled" data-level="11.3.4" id="browser-loader-prototype-@@instantiate"><span class="secno">11.3.4. </span><span class="content">BrowserLoader.prototype[ @@instantiate ](entry, source)</span><a class="self-link" href="#browser-loader-prototype-%40%40instantiate"></a></h4>
   <p>When the @@instantiate method is called, the following steps are taken:</p>
   <p><b>TODO:</b></p>
   <ul>
    <li>basically a no-op. 
    </li><li>but also needs to re-absorb opaque responses. 
   </li></ul>
   <p>The value of the name property of this function is "[Reflect.Loader.instantiate]".</p>
   <h2 class="no-num heading settled" id="annexes"><span class="content">Annexes</span><a class="self-link" href="#annexes"></a></h2>
   <h3 class="heading settled" id="list-of-well-known-intrinsic-objects"><span class="content">List of Well-Known Intrinsic Objects</span><a class="self-link" href="#list-of-well-known-intrinsic-objects"></a></h3>
   <p>The intrinsics are listed in table below:</p>
   <table>
    <thead>
     <tr>
      <th>Intrinsic Name
      </th><th>Description (<em>non-normative</em>)
    </th></tr></thead><tbody>
     <tr>
      <td>%Loader%
      </td><td>The loader constructor (<a href="#loader-constructor">3.1</a>)
     </td></tr><tr>
      <td>%LoaderPrototype%
      </td><td>The initial value of the *prototype* data property of %Loader% (<a href="#loader-prototype">3.2.1</a>)
     </td></tr><tr>
      <td>%BrowserLoader%
      </td><td>The browser loader constructor (<a href="#browser-loader-constructor">11.1</a>)
     </td></tr><tr>
      <td>%BrowserLoaderPrototype%
      </td><td>The initial value of the *prototype* data property of %BrowserLoader% (<a href="#browser-loader-prototype">11.2.1</a>)
     </td></tr><tr>
      <td>%Registry%
      </td><td>The registry constructor (<a href="#registry-constructor">4.2</a>)
     </td></tr><tr>
      <td>%RegistryPrototype%
      </td><td>The initial value of the *prototype* data property of %Registry% (<a href="#registry-prototype">4.3.1</a>)
     </td></tr><tr>
      <td>%ModuleStatus%
      </td><td>The module status constructor (<a href="#module-status-constructor">5.2</a>)
     </td></tr><tr>
      <td>%ModuleStatusPrototype%
      </td><td>The initial value of the *prototype* data property of %ModuleStatus% (<a href="#module-status-prototype">5.3.1</a>)
   </td></tr></tbody></table>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-num no-ref heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p>All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked non-normative. Everything else in this specification is normative. </p>
   <p>The key words "MUST", "MUST NOT", "REQUIRED",  "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this specification are to be interpreted as described in RFC2119. For readability, these words do not appear in all uppercase letters in this specification. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Conformance requirements phrased as algorithms or specific steps may be implemented in any manner, so long as the end result is equivalent. (In particular, the algorithms defined in this specification are intended to be easy to follow, and not intended to be performant.) </p>
  </div>
  <h2 class="no-num heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="indexlist">
   <li><a href="#reflective-module-record0">reflective module record</a><span>, in §8.1</span>
   </li><li><a href="#stage-entry">stage</a><span>, in §5.1.5</span>
  </li></ul>
  <h2 class="no-num heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119"><a class="self-link" href="#biblio-rfc2119"></a>[RFC2119]
   </dt><dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
  </dd></dl>
 
</body></html>